<!doctype html><html lang=ja><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="ライフゲームを自力で実装した部員がライフゲームについて語ります。"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/styles.css><link rel=icon href=/image/favicon.svg type=image/svg+xml><link rel="icon alternate" href=/image/favicon.ico><meta property="og:site_name" content="浅野学園物理部"><meta property="og:url" content="https://asanobuturi.github.io/document/2018/10/index.html"><meta property="og:title" content="ライフゲームをC++で実装してみた話｜浅野学園物理部"><meta property="og:description" content="ライフゲームを自力で実装した部員がライフゲームについて語ります。"><meta property="og:type" content="website"><meta property="og:image" content="https://asanobuturi.github.io/document/2018/10/thumbnail.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@Uchi54_APC"><script src=/general.js></script><link rel=stylesheet href=/css/article.css><link rel=stylesheet href=/css/tableOfContents.css><script src=https://kit.fontawesome.com/1e291c4f9b.js crossorigin=anonymous></script><title>ライフゲームをC++で実装してみた話｜浅野学園物理部</title><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML"></script><link rel=stylesheet href=/css/highlight.css></head><body><div id=nav-drawer><input id=nav-input type=checkbox class=nav-unshown>
<label id=nav-open for=nav-input><span class="bar bar1"></span><span class="bar bar2"></span><span class="bar bar3"></span><span class=menu>MENU</span>
<span class=close>CLOSE</span></label>
<label id=nav-close for=nav-input></label><div id=nav-content><a href=/index.html><img loading=lazy src=/image/favicon.svg id=nav-logo alt=浅野学園物理部></a>
<a class=nav-link href=/index.html>ホーム</a>
<a class=nav-link href=/about/index.html>物理部とは</a>
<a class="nav-link isActive" href=/document/index.html>部誌</a>
<a class=nav-link href=/game/index.html>ゲーム</a>
<a class=nav-link href=/blog/index.html>ブログ</a>
<a class=nav-link href=/electronic/index.html>電工の部屋</a><div class=nav-separator></div><a class=nav-link href=/credit/index.html>クレジット(ライセンス)</a></div></div><main><div id=main><div class=documentcontent><div id=breadcrumbs><a href=/index.html><img src=/image/icons/home-solid.svg class=inline-image>ホーム</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image><a href=../../index.html>部誌</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image><a href=../index.html>2018年度部誌</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image><a href=./index.html>ライフゲームをC++で実装してみた話</a></div><header class=documenttitle><h1 id=title>ライフゲームをC++で実装してみた話</h1><p class=author><img src=/image/icons/user-edit-solid.svg class=inline-image>片山 悠哉</p><div class=share><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class=twitter-share-button data-related=Uchi54_apc data-lang=ja data-show-count=false>Tweet</a>
<script async src=https://platform.twitter.com/widgets.js></script></div></header><div class=document><h2 id=はじめに>はじめに</h2><p>実は「実装してみた」要素の少ない紹介記事であるがお許しを(盛大なタイトル詐欺)。</p><h2 id=life-gameライフゲームとは>Life Game(ライフゲーム)とは？</h2><blockquote><p>ライフゲーム(Conway's Game of Life)は1970年にイギリスの数学者ジョン・ホートン・コンウェイ(John Horton Conway)が考案した生命の誕生、進化、淘汰などのプロセスを簡易的なモデルで再現したシミュレーションゲームである。単純なルールでその模様の変化を楽しめるため、パズルの要素を持っている。</p><figcaption>Wikipedia より</figcaption></blockquote><p>というもの、と言ってもわからないと思うので、ひとまずルールを書いておく。説明が簡潔で理解しやすかったため、これもまた Wikipediaから。 (一部視認性のために改変済み)最後に完成形のスクリーンショットを貼っておくので、イメージとしてはそれを参照して欲しい。</p><p>ライフゲームでは初期状態のみでその後の状態が決定される。碁盤のような格子があり、一つの格子はセル（細胞）と呼ばれる。各セルには8つの近傍のセルがある (ムーア近傍) 。各セルには「生」と「死」の2つの状態があり、あるセルの次のステップ（世代）の状態は周囲の8つのセルの今の世代における状態により決定される。</p><p>セルの生死は次のルールに従う。</p><p>また、中央のセルにおける次のステップでの生死の例を示す。生きているセルは■、死んでいるセルは□で表す。</p><ul><div style=display:flex><div><li><b>誕生</b></li><p>死んでいるセルに隣接する生きたセルがちょうど3つあれば、次の世代が誕生する。</p></div><img src=./images/img1.jpg width=10% height=10%></div><div style=display:flex><div><li><b>生存</b></li><p>生きているセルに隣接する生きたセルが2つか3つならば、次の世代でも生存する。</p></div><img src=./images/img2.jpg width=10% height=10%></div><div style=display:flex><div><li><b>過疎</b></li><p>生きているセルに隣接する生きたセルが1つ以下ならば、過疎により死滅する。</p></div><img src=./images/img3.jpg width=10% height=10%></div><div style=display:flex><div><li><b>過密</b></li><p>生きているセルに隣接する生きたセルが4つ以上ならば、過密により死滅する。</p></div><img src=./images/img4.jpg width=10% height=10%></div></ul><h2 id=取り敢えずやりたいこと>取り敢えずやりたいこと</h2><p>さて、ライフゲームを作るに当たって、画面の確保、描画などはDXライブラリに丸投げする予定なので、処理機構を考える。</p><p>やりたいこととしては、<br>すべてのセルを見る<br>→周りにある、生きているセルのカウント<br>→基準のセルが生きているか確認<br>→カウントに基づいて生死を決定する<br>こんな感じ。</p><p>セルは2次元配列を用意すれば良いが、取り敢えずvectorでいいだろう。ここで、セルのカウント後セルの状態を変更するのだが、変更後の状態をそのまま適応すると次のセルについて確認するときに影響してしまうので、コピーを用意してそちらに書き込むことにする。</p><p>つまり、セルの状態を保存するモノを2つ用意して、1つ目を見て生きたセルのカウントをし、その結果を2つ目に書き込んで最後に反映する。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>vector<span style=color:#f92672>&lt;</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>bool</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&gt;</span> map(ARRAY_SIZE, vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>bool</span><span style=color:#f92672>&gt;</span>(ARRAY_SIZE, false));
vector<span style=color:#f92672>&lt;</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>bool</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&gt;</span> map2(ARRAY_SIZE, vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>bool</span><span style=color:#f92672>&gt;</span>(ARRAY_SIZE, false));
</code></pre></td></tr></table></div></div><h2 id=書いてみよう>書いてみよう</h2><p>とりあえず周辺の8つをチェックしたいが、取り敢えず自分を含めた9個をforで走査し自分自身を除くことにする。</p><p>配列外参照チェックの処理を書くのが面倒なので、配列外参照をしたときに例外を投げてくれるatメンバ関数で若干楽をしてみる。</p><p>下に挙げるのはライフゲームの核となる部分。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> y <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; y <span style=color:#f92672>&lt;</span> ARRAY_SIZE; y<span style=color:#f92672>++</span>)<span style=color:#75715e>//ARRAY_SIZE:これの自乗個の
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; x <span style=color:#f92672>&lt;</span> ARRAY_SIZE; x<span style=color:#f92672>++</span>) {<span style=color:#75715e>//マス上で動かす。
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>int</span> count <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> y2 <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>; y2 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>; y2<span style=color:#f92672>++</span>) {
                <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> x2 <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>; x2 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>; x2<span style=color:#f92672>++</span>) {
                <span style=color:#66d9ef>try</span>
                {
                    <span style=color:#66d9ef>if</span> (map.at(y <span style=color:#f92672>+</span> y2).at(x <span style=color:#f92672>+</span> x2)
                    <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>(x2 <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> y2 <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>))count<span style=color:#f92672>++</span>;<span style=color:#75715e>//周辺の生きたセルの数
</span><span style=color:#75715e></span>                }
                <span style=color:#66d9ef>catch</span> (<span style=color:#66d9ef>const</span> std<span style=color:#f92672>::</span>exception<span style=color:#f92672>&amp;</span>) {}<span style=color:#75715e>//ここで若干楽をする
</span><span style=color:#75715e></span>                }
            }
            <span style=color:#66d9ef>if</span> (map[y][x]) {<span style=color:#75715e>//↓過疎および過密判定
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (count <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>||</span> count <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>4</span>)map2[y][x] <span style=color:#f92672>=</span> false;
        }
        <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (count <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>)map2[y][x] <span style=color:#f92672>=</span> true; <span style=color:#75715e>//誕生部分
</span><span style=color:#75715e></span>    }
map <span style=color:#f92672>=</span> map2;
</code></pre></td></tr></table></div></div><h2 id=改善>改善</h2><p>ここまでにおいては、最初のパターンを起動時に配置していたのだが、自由に操作するために書き込みモードと実行モードの2つのモードを用意することにした。</p><p>enumでWRITE,MAINの2つを宣言しswitch-caseで管理する。</p><p>また垂直同期待ちのトグル、マウスホイールによる更新頻度の調整機能も付けた。</p><p>ここでとある先輩から上下左右の端を繋げてはどうかとアドバイスが来たので、先程の周囲の8つをチェックする部分をこのように書き換えた。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>if</span> (map.at((ARRAY_SIZE <span style=color:#f92672>+</span> y <span style=color:#f92672>+</span> y2) <span style=color:#f92672>%</span> ARRAY_SIZE).at((ARRAY_SIZE <span style=color:#f92672>+</span> x <span style=color:#f92672>+</span> x2) <span style=color:#f92672>%</span> AR
RAY_SIZE) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>(x2 <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> y2 <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>))count<span style=color:#f92672>++</span>;
</code></pre></td></tr></table></div></div><p>これで範囲内に収まるようになった。</p><h2 id=パターンの紹介>パターンの紹介</h2><p>ライフゲームのルールは前述したようにかなり簡素なものだが、これだけで様々なセルの動く様子を観察することができる。Wikiにもたくさん例があるのだが、ここでも取り上げておく。</p><ul><div style=display:flex><div><li><b>固定物体</b></li><p>名前の通り、変化しないパターンである。その代表格が「ブロック」これはそれぞれの生きている(黒)セルの周辺に3つ生きているセルがあるので、どれも生存し続ける。</p></div><img src=./images/img5.jpg width=10% height=10%></div><div style=display:flex><div><li><b>振動子</b></li><p>一定の周期で元に戻るパターン。代表格としては「ブリンカー」誕生と過疎を繰り返し、縦と横交互に縦棒ができる。</p><p>名前の由来は、画面の更新頻度が高いモニタでこれを観察するとかなり点滅して見えるからである。</p></div><img src=./images/img6.jpg width=10% height=10%></div><div style=display:flex><div><li><b>移動物体</b></li><p>同じような形を保ったまま移動するパターン。代表格が「グライダー」高確率で発生しやすく、最小であるため大人気。</p></div><img src=./images/img7.jpg width=10% height=10%></div><li><b>繁殖型</b></li><p>生きているセルに隣接する生きたセルが4つ以上ならば、過密により死滅する。</p><img src=./images/img8.jpg><p>スペースさえあれば無限にセルが増え続けるパターン。代表格は「ゴスペル(又はゴスパー)のグライダー銃」これは無限にグライダーを打ち続ける機構で、初めて発見された増殖型であるため発見者の名前がつけられた。</p></ul><h2 id=まとめ>まとめ</h2><p>ライフゲームを楽しめる Golly というフリーソフトがあり、こちらはかなり高速に動かせるのでオススメしたい。後はニコニコ動画に「ライフゲームの世界」というタイトルの分かりやすく面白い動画があるので、こちらを見るとなおライフゲームの面白みが分かるかと思う。</p></div><nav class=nextPrev><div class=next>次へ<a href=https://asanobuturi.github.io/document/2018/11/>電気学の発展＞</a></div><div class=next>前へ<a href=https://asanobuturi.github.io/document/2018/9/>３を√５進数で表すと？＞</a></div></nav></div><nav id=sidebar><div id=sidemenu><div class=side-back><a href=../index.html>記事の一覧へもどる<img src=/image/icons/sign-out-alt-solid.svg class=inline-image></a></div><div class=side-prev><a href=https://asanobuturi.github.io/document/2018/9/><img src=/image/icons/angle-left-solid.svg class=inline-image>３を√５進数で表すと？</a></div><div class=side-next><a href=https://asanobuturi.github.io/document/2018/11/>電気学の発展<img src=/image/icons/angle-right-solid.svg class=inline-image></a></div></div><div id=indexblock><div class=indextitle>目次</div><ol class=indexcontents><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#life-gameライフゲームとは>Life Game(ライフゲーム)とは？</a></li><li><a href=#取り敢えずやりたいこと>取り敢えずやりたいこと</a></li><li><a href=#書いてみよう>書いてみよう</a></li><li><a href=#改善>改善</a></li><li><a href=#パターンの紹介>パターンの紹介</a></li><li><a href=#まとめ>まとめ</a></li></ul></nav></ol></div></nav></div><footer class=footer><p class=copyright>Copyright &copy; 2015 - 2022 Asano Physics Club, All Rights Reversed.</p><p class=note></p></footer></main></body></html>