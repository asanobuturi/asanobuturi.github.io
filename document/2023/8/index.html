<!doctype html><html lang=ja><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="往年の名機PC-98でのマインスイーパーの作成。"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/scss/styles.min.4a71567d35f0565714f9b264f620dd2c5abcdd3fd6d8bc1fe2bafa8114c2fe47.css><link rel=icon href=/image/favicon.svg type=image/svg+xml><link rel="icon alternate" href=/image/favicon.ico><meta property="og:site_name" content="浅野学園物理部"><meta property="og:url" content="https://asanobuturi.github.io/document/2023/8/index.html"><meta property="og:title" content="PC-98でのグラフィカルゲームの作成｜浅野学園物理部"><meta property="og:description" content="往年の名機PC-98でのマインスイーパーの作成。"><meta property="og:type" content="website"><meta property="og:image" content="https://asanobuturi.github.io/document/2023/8/thumbnail.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@Uchi54_APC"><link rel=canonical href=https://asanobuturi.github.io/document/2023/8/><script async src="https://www.googletagmanager.com/gtag/js?id=G-M4YH1E5WC1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-M4YH1E5WC1")</script><title>PC-98でのグラフィカルゲームの作成｜浅野学園物理部</title><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link rel=stylesheet href=/scss/highlight.min.9141ad816becb151cf8ba8de59090f7bd21363a83f62f10faaf55d5387e51d9e.css><link rel=stylesheet href=/scss/article.min.081b3cdbc5997940fe668ec26b2b0ce783dd885dd3a7cc2aab545fe3858b518d.css><link rel=stylesheet href=/scss/tableOfContents.min.603245923695f62c9be0618c1b6a10599acbf0f4f5056ffe631acd014b70fd17.css></head><body><nav id=nav-drawer><input id=nav-input type=checkbox class=nav-unshown>
<label id=nav-open for=nav-input><span class="bar bar1"></span>
<span class="bar bar2"></span>
<span class="bar bar3"></span>
<span class=menu>MENU</span>
<span class=close>CLOSE</span></label>
<label id=nav-close for=nav-input></label><div id=nav-content><a href=/index.html><img loading=lazy src=/image/favicon.svg id=nav-logo alt=浅野学園物理部></a>
<a class=nav-link href=/index.html>ホーム</a>
<a class=nav-link href=/about/index.html>物理部とは</a>
<a class="nav-link isActive" href=/document/index.html>部誌</a>
<a class=nav-link href=/game/index.html>ゲーム</a>
<a class=nav-link href=/blog/index.html>ブログ</a>
<a class=nav-link href=/electronic/index.html>電工の部屋</a><hr><a class=nav-link href=/credit/index.html>クレジット(ライセンス)</a></div></nav><main><div id=content><a name=top></a><div id=breadcrumbs><a href=/index.html><img src=/image/icons/home-solid.svg class=inline-image>ホーム</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/>部誌</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/2023/>2023年度・部誌</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/2023/8/>PC-98でのグラフィカルゲームの作成</a></div><header id=overview><h1 id=title>PC-98でのグラフィカルゲームの作成</h1><div><div class=properties><span class=author><img src=/image/icons/user-edit-solid.svg class=inline-image>
中３ S</span></div><div class=share><span><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class=twitter-share-button data-related=Uchi54_apc data-lang=ja data-show-count=false>Tweet</a>
<script async src=https://platform.twitter.com/widgets.js></script></span></div></div></header><article><p>PC-98(with Turbo C)でのマインスイーパーの制作記。</p><h2 id=なぜマインスイーパーか>なぜマインスイーパーか</h2><ul><li>全てがイベントハンドラで書くことができ、厳密なtick管理などが不要で楽。</li><li>程よく複雑で勉強に最適。</li><li>知っている人が多く、文化祭での展示に丁度良い。</li></ul><h2 id=使用する物>使用する物</h2><ul><li>PC-9821Xa10</li><li>MS-DOS Version 6.20</li><li>Turbo C++ Version 4.0</li></ul><h2 id=コード>コード</h2><h3 id=定義部>定義部</h3><p>グローバル変数を定義する。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> origin_x <span style=color:#f92672>=</span> <span style=color:#ae81ff>65</span>; <span style=color:#75715e>// (0, 0)のマスの左上x座標
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> origin_y <span style=color:#f92672>=</span> <span style=color:#ae81ff>77</span>; <span style=color:#75715e>// (0, 0)のマスの左上y座標
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> mines <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;    <span style=color:#75715e>// 地雷の数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> mode <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;       <span style=color:#75715e>// `graphics.h`の初期化時に必要なモード番号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> driver <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;     <span style=color:#75715e>// `graphics.h`の初期化時に必要なドライバ番号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> error_code <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#75715e>// `graphics.h`の初期化時のエラーコード
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> px, py <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;     <span style=color:#75715e>// ポインタ座標
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> end <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;                <span style=color:#75715e>// エンドフラグ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> cells <span style=color:#f92672>=</span> ROWS <span style=color:#f92672>*</span> COLUMNS; <span style=color:#75715e>// まだ空いていないマスの数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> flags <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;              <span style=color:#75715e>// 旗の数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> mine_data[ROWS<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>][COLUMNS<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> {<span style=color:#ae81ff>0</span>};    <span style=color:#75715e>// 地雷の位置を格納
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> display_data[ROWS<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>][COLUMNS<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> {<span style=color:#ae81ff>0</span>}; <span style=color:#75715e>// ヒントの数字を格納
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> open_data[ROWS<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>][COLUMNS<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> {<span style=color:#ae81ff>0</span>};    <span style=color:#75715e>// 開閉を格納
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> cell_msg[<span style=color:#ae81ff>32</span>];    <span style=color:#75715e>// `draw_cell`関数で描画関数の引数に使用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>char</span> msg_mines[<span style=color:#ae81ff>32</span>];   <span style=color:#75715e>// 地雷の数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>char</span> msg_flagged[<span style=color:#ae81ff>32</span>]; <span style=color:#75715e>// 旗の数(`flags`)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>char</span> msg_cells[<span style=color:#ae81ff>32</span>];   <span style=color:#75715e>// まだ空いていないマスの数(`cells`)
</span></span></span></code></pre></td></tr></table></div></div><h3 id=main関数>main関数</h3><p>まず、変数の定義は冒頭でしか行えないため定義を済ましておく。
グラフィックを扱うために初期化が必要なので、グラフィックモジュールの初期化とエラーのチェックを行う<code>init</code>関数を呼び出し、その後盤面の描画を行う<code>draw_map</code>関数を呼び出す。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> first <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// 初回のみマップを生成するためのフラグ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> c <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;     <span style=color:#75715e>// キーコードを格納
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> id;        <span style=color:#75715e>// `switch`文での分岐のためのID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>init</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>draw_map</span>();
</span></span></code></pre></td></tr></table></div></div><p>メインループ<code>white(1)</code>に入る。<code>getch()</code>関数で入力を待ち受け、その後<code>if</code>文でキーコード別に処理を分岐させる。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>c <span style=color:#f92672>=</span> <span style=color:#a6e22e>getch</span>(); <span style=color:#75715e>// キー入力待受
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>0x1b</span> <span style=color:#f92672>==</span> c) {  <span style=color:#75715e>// ESC
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>closegraph</span>(); <span style=color:#75715e>// グラフィックモードを終了
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>0x0d</span> <span style=color:#f92672>==</span> c <span style=color:#f92672>|</span> <span style=color:#ae81ff>0x20</span> <span style=color:#f92672>==</span> c) { <span style=color:#75715e>// Enter or Space
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (first) {
</span></span><span style=display:flex><span>        first <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>create_map</span>(); <span style=color:#75715e>// 初回のみマップを生成
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>open</span>(px, py); <span style=color:#75715e>// ポインターのxy座標を引数に渡して開く
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* マスの数の表示更新処理 */</span>
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>0x09</span> <span style=color:#f92672>==</span> c) { <span style=color:#75715e>// Tab
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>flag</span>(px, py); <span style=color:#75715e>// ポインターのxy座標を引数に渡して旗を配置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* 旗の数の表示更新処理 */</span>
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>0</span> <span style=color:#f92672>==</span> open_data[py<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][px<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>&amp;</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>11</span> <span style=color:#f92672>!=</span> display_data[py<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][px<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>]) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>draw_cell</span>(origin_x<span style=color:#f92672>+</span>px<span style=color:#f92672>*</span><span style=color:#ae81ff>50</span>, origin_y<span style=color:#f92672>+</span>py<span style=color:#f92672>*</span><span style=color:#ae81ff>45</span>,
</span></span><span style=display:flex><span>                  <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 空いていない場合は白を描画
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>draw_cell</span>(origin_x<span style=color:#f92672>+</span>px<span style=color:#f92672>*</span><span style=color:#ae81ff>50</span>, origin_y<span style=color:#f92672>+</span>py<span style=color:#f92672>*</span><span style=color:#ae81ff>45</span>,
</span></span><span style=display:flex><span>                  display_data[py<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][px<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// すでに開いている or 旗が立っている場合は数字または旗を描画
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> { <span style=color:#75715e>/* キー別に`id`を振る */</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> (id) { <span style=color:#75715e>/* ポインタ移動処理 */</span> }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ポインタ移動後にポインタを再描画
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>setcolor</span>(RED);
</span></span><span style=display:flex><span><span style=color:#a6e22e>rectangle</span>(origin_x<span style=color:#f92672>+</span>px<span style=color:#f92672>*</span><span style=color:#ae81ff>50</span>, origin_y<span style=color:#f92672>+</span>py<span style=color:#f92672>*</span><span style=color:#ae81ff>45</span>,
</span></span><span style=display:flex><span>         origin_x<span style=color:#f92672>+</span>px<span style=color:#f92672>*</span><span style=color:#ae81ff>50</span><span style=color:#f92672>+</span><span style=color:#ae81ff>45</span>, origin_y<span style=color:#f92672>+</span>py<span style=color:#f92672>*</span><span style=color:#ae81ff>45</span><span style=color:#f92672>+</span><span style=color:#ae81ff>40</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>setcolor</span>(WHITE);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (end) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>closegraph</span>(); <span style=color:#75715e>// グラフィックモードを終了
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><br><hr><p><code>main</code>関数の要点は以上。</p><h3 id=init関数>init関数</h3><p>コメントに記した通り。初期化→エラー処理→描画関係の初期化処理という形である。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>driver <span style=color:#f92672>=</span> DETECT;               <span style=color:#75715e>// 自動検出を要求
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>initgraph</span>(<span style=color:#f92672>&amp;</span>driver, <span style=color:#f92672>&amp;</span>mode, <span style=color:#e6db74>&#34;&#34;</span>); <span style=color:#75715e>// ドライバと画面モードIDを渡して初期化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>error_code <span style=color:#f92672>=</span> <span style=color:#a6e22e>graphresult</span>();    <span style=color:#75715e>// エラーコードを取得
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (error_code <span style=color:#f92672>!=</span> grOk) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Graphics System Error: %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#a6e22e>grapherrormsg</span>(error_code));
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>1</span>); <span style=color:#75715e>// エラーならメッセージを出して終了
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 描画初期化処理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>settextstyle</span>(DEFUALT_FONT, HORIZ_DIR, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>setcolor</span>(WHITE);
</span></span></code></pre></td></tr></table></div></div><h3 id=open関数>open関数</h3><p>基本的には開閉を格納するリストと照らし合わせ、開いているないしは座標が描画枠外に出ているなら処理を終了する。</p><p>前述の二つ両方に当てはまらないのなら地雷の存否で分岐し、あるなら<code>game_over</code>関数を走らせ処理を終了、ないのなら自己のマスを再描画しゲームクリアの判定を行ったのちに数字の存否で分岐、０、つまり何も書かれていない状態であれば周り八マスに対し<code>open</code>関数を呼び出して再帰する。(数字があるのなら再描画のみで終了)</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>if</span> (x<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span> x<span style=color:#f92672>&gt;</span>COLUMNS<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> y<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span> y<span style=color:#f92672>&gt;</span>ROWS<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> open_data[y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span>; <span style=color:#75715e>// 枠外またはすでに開いているのなら終了
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>open_data[y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>cells<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>setfillstyle</span>(SOLID_FILL, BLACK);
</span></span><span style=display:flex><span><span style=color:#a6e22e>bar</span>(origin_x<span style=color:#f92672>+</span>x<span style=color:#f92672>*</span><span style=color:#ae81ff>50</span>, origin_y<span style=color:#f92672>+</span>y<span style=color:#f92672>*</span><span style=color:#ae81ff>45</span>,
</span></span><span style=display:flex><span>    origin_x<span style=color:#f92672>+</span>x<span style=color:#f92672>*</span><span style=color:#ae81ff>50</span><span style=color:#f92672>+</span><span style=color:#ae81ff>45</span>, origin_y<span style=color:#f92672>+</span>y<span style=color:#f92672>*</span><span style=color:#ae81ff>45</span><span style=color:#f92672>+</span><span style=color:#ae81ff>40</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>setfillstyle</span>(SOLID_FILL, WHITE);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>==</span> mine_data[y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>]) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>game_over</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>draw_cell</span>(origin_x<span style=color:#f92672>+</span>x<span style=color:#f92672>*</span><span style=color:#ae81ff>50</span>, origin_y<span style=color:#f92672>+</span>y<span style=color:#f92672>*</span><span style=color:#ae81ff>45</span>,
</span></span><span style=display:flex><span>              display_data[y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>]); <span style=color:#75715e>// 自己のマスを再描画
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (cells <span style=color:#f92672>==</span> mines) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>game_clear</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>0</span> <span style=color:#f92672>==</span> display_data[y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>]) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>/* 周囲の八マスに対し再帰処理 */</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><br><hr><p><code>open</code>関数の要点は以上。</p><h3 id=create_map関数>create_map関数</h3><p><code>rand</code>関数でランダムな座標を指定、初手で詰まないようにポインタを中心とする九マスに入っていないことを確認してから<code>i</code>に加算し周囲八マスの<code>display_data</code>(表示用データ)に加算する。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#75715e>// for文括弧内では定義できないので先に定義
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>srand</span>((<span style=color:#66d9ef>unsigned</span>)<span style=color:#a6e22e>time</span>(NULL)); <span style=color:#75715e>// 乱数を初期化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>mines;) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> x, y <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> <span style=color:#a6e22e>rand</span>()<span style=color:#f92672>%</span>COLUMNS<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>; <span style=color:#75715e>// 描画範囲外とならないために1を加算
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    y <span style=color:#f92672>=</span> <span style=color:#a6e22e>rand</span>()<span style=color:#f92672>%</span>ROWS<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>;    <span style=color:#75715e>// 描画範囲外とならないために1を加算
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>!=</span> mine_data[y][x]) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (x <span style=color:#f92672>&lt;</span> px <span style=color:#f92672>|</span> px<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>&lt;</span> x <span style=color:#f92672>|</span> y <span style=color:#f92672>&lt;</span> py <span style=color:#f92672>|</span> py<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>&lt;</span> y) {
</span></span><span style=display:flex><span>            mine_data[y][x] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// 地雷を設置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            i<span style=color:#f92672>++</span>; <span style=color:#75715e>// `i`を加算しループを進める
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>/* 周囲八マスの`display_data`を加算 */</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><br><hr><p>以上で解説は終了。</p><hr><h2 id=詰まったところ>詰まったところ</h2><h3 id=やはり性能が低い>やはり性能が低い</h3><p>今のPCであれば全てのマスを再描画することを毎フレーム行えるだろうが、PC-98の性能では(高水準言語で書いていることもあるだろうが)処理が追い付かず、少しラグが生じてしまう。そのため、毎度更新があるマスだけを更新しなければいけないことがコードを複雑化させる原因となった。</p><h3 id=警告などない>警告などない</h3><p><code>Turbo C</code>付属のエディタを使用しているのだが、警告など出ない。コピー&ペーストはショートカットがキーボードのほぼ対局の位置にあり、シンタックスハイライトは甘えと言わんばかりに数値と文字列にしか色がつかない。現代の<code>Ctrl+Z</code>のようなものを使用すると<strong>カーソルの動作が戻る。</strong><code>if</code>文で<code>==</code>を<code>=</code>と書こうとも警告など出ない。(コンパイル時にも)しかしこれだけは対処法がある。現代の一般的な記法では変数を左辺に置き数値/文字列を右辺に置くだろうがそれを逆にすることでコンパイル時にエラーが出るようになり、誤りに気づける。(これはヨーダ記法と言われている)</p><h3 id=型変換が特殊>型変換が特殊</h3><p>私はC言語もC++も常用しないのだが、方変換の方法が特殊なようだ。例えば<code>int</code>-><code>char</code>の変換を行いたい場合、<code>itoa</code>関数というものを使用し、第一引数に<code>int</code>型の変数、第二引数に<code>char</code>型、第三引数に基数を入力することで変換ができる。これを知るまでは、<code>if</code>文を列挙して<code>1</code>(<code>int</code>)なら<code>1</code>(<code>char</code>)を出力するというスパゲッティコードを書いていた。</p><h3 id=セグメントエラーでpcが落ちる>セグメントエラーでPCが落ちる。</h3><p><code>draw_cell</code>関数で毎度<code>char</code>型のローカル変数を定義していたらがPCが落ちるという状況に陥っていたことがある。おそらくメモリを使いすぎたのかなんなのか強制的に落ちてしまうのである。解決策はグローバル変数で定義することだった。</p><h2 id=終わりに>終わりに</h2><p>今回でPC-98でのグラフィック処理の初歩を学んだ。やはり普段からPythonのようなぬるま湯のような言語に浸かってきているため、PC-98とC言語という環境は新しいことを沢山学ばせてくれた。来年に向けてはブロック崩しのような毎秒動きがある高度ゲームなどを作成していきたい。</p><h2 id=参考文献>参考文献</h2><ul><li>OBのTwitter(𝕏)</li><li>THE C PROGRAMMING LANGUAGE (Prentice Hall Software)</li><li>[KB405963 - EMM386.EXEのエラー(Exception Error)について][http://radioc.web.fc2.com/weblib/ms/dos62v/405963.htm]</li><li>[Turbo_C_Reference_Guide_1987.pdf][http://bitsavers.informatik.uni-stuttgart.de/pdf/borland/turbo_c/Turbo_C_Reference_Guide_1987.pdf]</li><li>[ASCIIコード表][https://www.k-cube.co.jp/wakaba/server/ascii_code.html]</li></ul></article><span class=next>次へ<a href=https://asanobuturi.github.io/document/2023/9/>PC-猫だとわからない弊部のネットワーク＞</a></span><br><span class=prev>前へ<a href=https://asanobuturi.github.io/document/2023/7/>AIを競技プログラミングで活用してみる＞</a></span></div><aside id=sidebar><nav id=sidemenu><div class=side-back><a href=../index.html>記事の一覧へもどる<img src=/image/icons/sign-out-alt-solid.svg class=inline-image></a></div><div class=side-prev><a href=https://asanobuturi.github.io/document/2023/7/><img src=/image/icons/angle-left-solid.svg class=inline-image>AIを競技プログラミングで活用してみる</a></div><div class=side-next><a href=https://asanobuturi.github.io/document/2023/9/>PC-猫だとわからない弊部のネットワーク<img src=/image/icons/angle-right-solid.svg class=inline-image></a></div></nav><section id=indexblock><header class=indextitle>目次</header><nav id=TableOfContents><ul><li><a href=#なぜマインスイーパーか>なぜマインスイーパーか</a></li><li><a href=#使用する物>使用する物</a></li><li><a href=#コード>コード</a><ul><li><a href=#定義部>定義部</a></li><li><a href=#main関数>main関数</a></li><li><a href=#init関数>init関数</a></li><li><a href=#open関数>open関数</a></li><li><a href=#create_map関数>create_map関数</a></li></ul></li><li><a href=#詰まったところ>詰まったところ</a><ul><li><a href=#やはり性能が低い>やはり性能が低い</a></li><li><a href=#警告などない>警告などない</a></li><li><a href=#型変換が特殊>型変換が特殊</a></li><li><a href=#セグメントエラーでpcが落ちる>セグメントエラーでPCが落ちる。</a></li></ul></li><li><a href=#終わりに>終わりに</a></li><li><a href=#参考文献>参考文献</a></li></ul></nav></section></aside></main><footer id=footer><div class=section><nav class=grid><div><label class=headline>CONTENT</label><ul><li><a href=/>Home</a></li><li><a href=/document/>Docs</a></li><li><a href=/game/>Games</a></li><li><a href=/blog/>Blog</a></li><li><a href=/electronic/>Electronic</a></li></ul></div><div><label class=headline>CONTACT</label><ul><li><a target=_blank href=https://x.com/Uchi54_apc>X</a></li><li><a target=_blank href=https://github.com/asanobuturi>GitHub Organization</a></li><li><a target=_blank href=https://github.com/asanobuturi/asanobuturi.github.io>Repository</a></li><li><a target=_blank href=https://github.com/asanobuturi/asanobuturi.github.io/issues>Issues</a></li></ul></div><div><label class=headline>ABOUT</label><ul><li><a href=/about/>About Us</a></li></ul></div></nav></div><hr><div class=section><p class=copyright>Copyright &copy; 2015 - 2023 Asano Physics Club, All Rights Reversed.</p><nav class=sns><a target=_blank href=https://twitter.com/Uchi54_apc><svg xmlns="http://www.w3.org/2000/svg" fill="currentcolor" viewBox="0 0 248 204"><path d="M221.95 51.29c.15 2.17.15 4.34.15 6.53.0 66.73-50.8 143.69-143.69 143.69v-.04c-27.44.04-54.31-7.82-77.41-22.64 3.99.48 8 .72 12.02.73 22.74.02 44.83-7.61 62.72-21.66-21.61-.41-40.56-14.5-47.18-35.07 7.57 1.46 15.37 1.16 22.8-.87-23.56-4.76-40.51-25.46-40.51-49.5v-.64c7.02 3.91 14.88 6.08 22.92 6.32C11.58 63.31 4.74 33.79 18.14 10.71c25.64 31.55 63.47 50.73 104.08 52.76-4.07-17.54 1.49-35.92 14.61-48.25 20.34-19.12 52.33-18.14 71.45 2.19 11.31-2.23 22.15-6.38 32.07-12.26-3.77 11.69-11.66 21.62-22.2 27.93 10.01-1.18 19.79-3.86 29-7.95-6.78 10.16-15.32 19.01-25.2 26.16z"/></svg></a><a target=_blank href=https://github.com/asanobuturi><svg class="w-5 h-5" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483.0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951.0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65.0.0.84-.27 2.75 1.026A9.564 9.564.0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688.0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855.0 1.338-.012 2.419-.012 2.747.0.268.18.58.688.482A10.019 10.019.0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/></a></nav></div></footer></body></html>