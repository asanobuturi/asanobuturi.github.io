<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115439668-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
          dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'UA-115439668-1');
  </script>

  <meta property="og:url" content="https://asanobuturi.github.io/document/2022/server/index.html"/>
  <meta property="og:title" content="部内で鯖を飼育する|浅野学園物理部"/>
  <meta property="og:description" content=""/>
  <meta property="og:type" content="website"/>
  <meta property="og:image" content="https://asanobuturi.github.io/document/2022/server/thumbnail.jpg"/><!--ここまでOGP設定-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@Uchi54_APC" /> <!--ここまでTwitterカード設定-->

  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML' async></script><!--MathJax適用(LaTeX数式表示用)-->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta name="description" content="部内サーバーをつくったというおはなし" />

  <title>部内で鯖を飼育する|浅野学園物理部</title>

  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

  <link rel="stylesheet" href="https://asanobuturi.github.io/styles.css">
  <link rel="stylesheet" href="https://asanobuturi.github.io/blog_new.css">
  <link rel="stylesheet" href="https://asanobuturi.github.io/highlight.css"><!--シンタックスハイライト-->
  <link rel="shortcut icon" href="https://asanobuturi.github.io/image/favicon.ico">

  <script type="text/javascript" src="//typesquare.com/accessor/script/typesquare.js?YME8OdI00sA%3D" charset="utf-8"></script>
  <script src="https://kit.fontawesome.com/1e291c4f9b.js" crossorigin="anonymous"></script>

</head>
<body>
  <div id="nav-drawer">
  </div>
  <main>
    <div id="main">
        <div class="documentcontent"><article>
            <div id="breadcrumbs">
                <i class="fas fa-home"></i><a href="https://asanobuturi.github.io/index.html">ホーム</a><i class="fas fa-angle-right"></i><a href="https://asanobuturi.github.io/document.html">部誌</a><i class="fas fa-angle-right"></i><a href="../index.html">2022年度部誌</a><i class="fas fa-angle-right"></i>部内で鯖を飼育する
            </div>
            <header class="documenttitle">
                <h1>部内で鯖を飼育する</h1>
                <p class="author"><i class="fas fa-user-edit"></i>高2
Y.K.</p>
                <a href="https://twitter.com/intent/tweet?url=https://asanobuturi.github.io/document/2022/server/index.html&text=部内で鯖を飼育する|浅野学園物理部&via=Uchi54_APC&related=Uchi54_APC" class="twitter-share-button" data-show-count="false">Tweet</a>
                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><!--Twitterのシェアボタンの中身(URL・記事タイトル)も記述すること-->
            </header>
            <div class="document">
              <h2 id="鯖生き物ではない">0.鯖（生き物ではない）</h2>
              <blockquote>
              <h2 id="鯖">鯖</h2>
              <p>サーバー(server)コンピューターのこと。コンピューター・ネットワーク上でクライアントから受けたリクエストに対し、様々なサービスを提供するシステム。
              <em>–(株)朝日新聞出版発行「知恵蔵」より</em></p>
              </blockquote>
              <p>もちろん生き物の鯖ではありません。物理部の劣悪な環境下では魚の鯖はおそらく飼育不可能でしょう。</p>
              <h2 id="鯖を飼う理由">1.鯖を飼う理由</h2>
              <p>物理部ではいままで部員にWindows搭載ノートパソコン等を購入することを部員に推奨してきました。これは物理部の限られた部費で部員全員分のコンピューターを用意するのが困難なためです。実は物理部の部員は100人ほどいます。<del>なお部活出席率は</del>普段から部活にいる20人分のコンピューターを部活動が負担するのは到底不可能です。データをローカルに保存する都合上、毎回の部活で利用するコンピューターが固定されることになります。国税庁が言うにはコンピューターも消耗品、耐用年数は5年とされています。プログラミングや動画編集などを行う都合上ある程度のマシンパワーが必要になってくるため1台当たりの値段はかなり高額になります。<!--さらに追い打ちをかけるように2020年から浅野学園の生徒にChromebookを購入をすることになりました。これによって2代目のパソコンを購入することに否定的な部員の保護者の方々がいらっしゃるのも、その気持ちもよくわかります。-->
              そこで考えたのは「部内にNASを立ててそこにデータを保管する」というものでした。しかし市販のNASを買って設置するだけでは面白みに欠けます。そんなわけで部内にファイルサーバーを建てるという結論に(自分の中で)達しました。</p>
              <h2
              id="鯖の品種パーツの選定">2.鯖の品種（パーツ）の選定</h2>
              <p>サーバーたるものやっぱり常時起動は見据えなければなりません。また浅野学園では生徒は学校のネットワークを利用するのを利用することは禁じられているため、部内ネットワークを立てる必要も出てきました。</p>
              <ol type="1">
              <li>CPU<br />
              </li>
              <li>マザーボード<br />
              </li>
              <li>メモリー<br />
              </li>
              <li>SSD<br />
              </li>
              <li>グラフィックカード<br />
              </li>
              <li>電源<br />
              </li>
              <li>ケース<br />
              </li>
              <li>オペレーティングシステム<br />
              </li>
              <li>Wi-Fiルーター</li>
              </ol>
              <p>それぞれ選定品とその理由を説明できればと思います。またCPU～グラフィックボードは実店舗で購入できるかどうかも判断材料に含まれます。</p>
              <ol type="1">
              <li><strong>CPU</strong> 　今回はIntel Corei3
              10105を選択しました。理由は簡単。現行のCoreシリーズで一番省電力だから。サーバーなのでやっぱり電力は気になります。市販のNASではCeleronなどが一般的ですが、将来的にサーバーからデスクトップコンピューターに生まれ変わることも見据えて
              Core i3を選択しました。<br />
              </li>
              <li><strong>マザーボード</strong>
              　ツクモでメモリースロットが4本で一番安かったASRockのH570M
              Pro4を選択しました。<del>無駄に光ります</del><br />
              </li>
              <li><strong>メモリー</strong>
              　メモリーはファイルサーバーで割とこだわるべき場所な気はします。無難に8GB2枚組です。<br />
              </li>
              <li><strong>SSD</strong>
              　ファイルサーバーでかなり重要な場所です。これを適当に決めてしまうと故障によってファイルの消失もあり得ます。今回はシステムドライブとデータドライブを分けることにしました。システムドライブはADATAのSATA120GB、データドライブは信頼性と速度を重視しKIOXIAのM.2
              1TBモデルを選択しました。<br />
              </li>
              <li><strong>グラフィックカード</strong>
              　所詮ファイルサーバーなので高性能なものは必要ありません。当初はCPUは内蔵グラフィックなしの下位モデルを選択し、日本最安グラフィックカードのGT710を使用しようかと思いましたがツクモに行ったところCPUの価格差があまりなかったので内臓グラフィック搭載のCPUを選びました。強いて言うならIntel
              UHDグラフィック630でしょうか。<br />
              </li>
              <li><strong>電源</strong>
              　これはサーバーで一番おろそかにしてはいけないものじゃないでしょうか。激安の電源ユニットを利用して発火したら洒落になりません。比較的安め、ある程度の信頼はできる玄人志向の450W電源を選びました。<br />
              </li>
              <li><strong>ケース</strong>
              　別にケースは性能に直結しないのでどんなものを選んでもいいのですが、物理部は収納スペースの都合上スチールラックの上に設置することになったので横置きケースを選ばざるを得ませんでした。これで地震が来ても大丈夫(なはず)。<br />
              </li>
              <li><strong>オペレーティングシステム</strong>
              　ファイルサーバーとして運用する都合上管理は簡単なほうがいいに決まってます。そのほうが引き継ぎも楽です。詳細は後ほど。<br />
              </li>
              <li><strong>Wi-fiルーター</strong>
              　サーバー設置場所と物理部の普段の活動場所との間には鉄製の扉が2枚あります。そのためアンテナが本体から飛び出しているもの且つWi-Fi6に対応していて、ちょうど購入時にAmazonセールで安かったTPLINK
              AX4800を購入しました。</li>
              </ol>
              <h2 id="鯖のos">3.鯖のOS</h2>
              <p>オペレーティングシステム、これはかなり迷いました。ubuntuを利用してもよかったのですが、後輩への引き継ぎが困難を極めると予想したため、データ保管サーバー用のOSとしては定番なOpenmediavaultで環境を構築しました。このOSはWeb上で簡単に操作できるのが特徴です。やっぱり操作しやすいのはいいですね。</p>
              <h2 id="トラブル">4.トラブル</h2>
              <p>OpenMediaVaultをインストールした後にトラブルが発生しました。それは「OpenMediaVaultがIntel
              I219-Vを認識してくれない」というものでした。Intel
              I219-VはマザーボードのRJ45(=LANコネクタ)の端子です。調べてみるとOpenMediaVaultを導入する前にUbuntuをインストールし、I219-Vのドライバーを導入しないといけないらしい。いまさら再インストールするのは時間がかがりすぎると感じたので、SSDのみI219-Vを搭載していないPCで起動させ、そこで初期設定のみ進めることにしました。インターネットに繋げられないのですばらしいWeb操作も一切できません。ずっと黒い画面とにらめっこ。<del>精神的にもつらい。</del></p>
              <h2 id="ファイル構成">5.ファイル構成</h2>
              <p>前述の通りこのサーバーにはデータドライブとして1TBのSSDがあります。そこで今回は以下のように割り振るようにしました。</p>
              <pre><code>KIOXIA 1TB SSD
　├ goole drive backup -250GB
　└ data -750GB</code></pre>
              <p>google drive
              backupは物理部の共有ドライブの内容をクローンする予定でしたが、時間がないので後輩に頑張ってもらいます。
              割り当てさえ決まったらあとはSMBを有効にしてPCからログインするだけです。</p>
              <h2 id="構築完了">6.構築完了</h2>
              <p>CrystalDiskMarkで転送速度を計測してみました。<br />
              <img src="https://yamajikai.jp/cdm.png"
              height="200" /></p>
              <p>1Gbpsで優先接続だとこんな感じ。1Gbpsの転送速度上限が125Mb/sなんですけど超えてるのは何なんでしょう。。。画像はないですが2.4Ghzでのアクセス時でRead20Mbps、5Ghzアクセス時は40Mbps程度とまずますの結果です。
              普段はArduinoのスケッチを読み出しするだけだと思うので、かなり過剰設備ではありますが何とか完成してよかったです。</p>
              <p>ちなみに完成してから1週間後に再度OpenMediaVaultがI219-Vを認識しなくなったのはまた別のお話…</p>
              <h2 id="special-thanks">7.Special Thanks</h2>
              <ul>
              <li>予算を下ろしてくれた顧問の先生</li>
              <li>OpenMediaVault Forum “Network problem with Intel
              I219-V when installing OMV6”</li>
              </ul>
            </div>
            <nav class="nextPrev">
                <div class="prev">前へ<a href="../PC98APCOS/index.html">「自作OSで文字列をPC98に表示する」
                        &gt;</a></div>
                <div class="next">次へ<a href="../edit/index.html">「編集後記」
                        &gt;</a></div>
            </nav>
        </article></div>
        <nav id="sidebar">
            <div id="sidemenu">
                <div class="side-back"><a href="../index.html">記事の一覧へもどる<i class="fas fa-sign-out-alt"></i></a></div>
                <div class="side-prev"><i class="fas fa-angle-left"></i><a href="../PC98APCOS/index.html">「自作OSで文字列をPC98に表示する」</a></div>
                <div class="side-next"><a href="../edit/index.html">「編集後記」</a><i class="fas fa-angle-right"></i></div>
            </div>
            <div id="indexblock">
                <div class="indextitle">目次</div>
                <ol class="indexcontents">
                    <ul>
                    <li><a href="#鯖生き物ではない"
                    id="toc-鯖生き物ではない">0.鯖（生き物ではない）</a></li>
                    <li><a href="#鯖を飼う理由"
                    id="toc-鯖を飼う理由">1.鯖を飼う理由</a></li>
                    <li><a href="#鯖の品種パーツの選定"
                    id="toc-鯖の品種パーツの選定">2.鯖の品種（パーツ）の選定</a></li>
                    <li><a href="#鯖のos"
                    id="toc-鯖のos">3.鯖のOS</a></li>
                    <li><a href="#トラブル"
                    id="toc-トラブル">4.トラブル</a></li>
                    <li><a href="#ファイル構成"
                    id="toc-ファイル構成">5.ファイル構成</a></li>
                    <li><a href="#構築完了"
                    id="toc-構築完了">6.構築完了</a></li>
                    <li><a href="#special-thanks"
                    id="toc-special-thanks">7.Special Thanks</a></li>
                    </ul>
                </ol>
            </div>
        </nav>
    </div>
    <footer class="footer">
        <div class="">
            <p class="copylight">&copy; 2015-2022 Asano Physics Club</p>
        </div>
    </footer>
</main>
</body>
</html>
