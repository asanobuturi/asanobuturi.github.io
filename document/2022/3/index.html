<!doctype html><html lang=ja><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="文化祭で展示していたプラレール改造の解説です"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/scss/styles.min.4a71567d35f0565714f9b264f620dd2c5abcdd3fd6d8bc1fe2bafa8114c2fe47.css><link rel=icon href=/image/favicon.svg type=image/svg+xml><link rel="icon alternate" href=/image/favicon.ico><meta property="og:site_name" content="浅野学園物理部"><meta property="og:url" content="https://asanobuturi.github.io/document/2022/3/index.html"><meta property="og:title" content="プラレールの改造について｜浅野学園物理部"><meta property="og:description" content="文化祭で展示していたプラレール改造の解説です"><meta property="og:type" content="website"><meta property="og:image" content="https://asanobuturi.github.io/document/2022/3/thumbnail.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@Uchi54_APC"><link rel=canonical href=https://asanobuturi.github.io/document/2022/3/><script async src="https://www.googletagmanager.com/gtag/js?id=G-M4YH1E5WC1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-M4YH1E5WC1")</script><title>プラレールの改造について｜浅野学園物理部</title><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link rel=stylesheet href=/scss/highlight.min.9b4082acf90ec245e99e303a9e09c0a4ffa77b9754c98965a6bdb067c39e9c14.css><link rel=stylesheet href=/scss/article.min.5ab46a9154b676996cd1867b86fa75a6f6dfd4cf58534c093b363ff6739f3f03.css><link rel=stylesheet href=/scss/tableOfContents.min.603245923695f62c9be0618c1b6a10599acbf0f4f5056ffe631acd014b70fd17.css></head><body><nav id=nav-drawer><input id=nav-input type=checkbox class=nav-unshown>
<label id=nav-open for=nav-input><span class="bar bar1"></span>
<span class="bar bar2"></span>
<span class="bar bar3"></span>
<span class=menu>MENU</span>
<span class=close>CLOSE</span></label>
<label id=nav-close for=nav-input></label><div id=nav-content><a href=/index.html><img loading=lazy src=/image/favicon.svg id=nav-logo alt=浅野学園物理部></a>
<a class=nav-link href=/index.html>ホーム</a>
<a class=nav-link href=/about/index.html>物理部とは</a>
<a class="nav-link isActive" href=/document/index.html>部誌</a>
<a class=nav-link href=/game/index.html>ゲーム</a>
<a class=nav-link href=/blog/index.html>ブログ</a>
<a class=nav-link href=/electronic/index.html>電工の部屋</a><hr><a class=nav-link href=/credit/index.html>クレジット(ライセンス)</a></div></nav><main><div id=content><a name=top></a><div id=breadcrumbs><a href=/index.html><img src=/image/icons/home-solid.svg class=inline-image>ホーム</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/>部誌</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/2022/>2022年度・部誌</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/2022/3/>プラレールの改造について</a></div><header id=overview><h1 id=title>プラレールの改造について</h1><div><div class=properties><span class=author><img src=/image/icons/user-edit-solid.svg class=inline-image>
中３ chakkun</span></div><div class=share><span><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class=twitter-share-button data-related=Uchi54_apc data-lang=ja data-show-count=false>Tweet</a>
<script async src=https://platform.twitter.com/widgets.js></script></span></div></div></header><article><h2 id=はじめに>はじめに</h2><p>物理部の中3の電工班です。今回が初めての部誌となっています。今回は、文化祭で展示する作品の説明的なものを書かせていただきます。</p><h2 id=始めたきっかけ>始めたきっかけ</h2><p>部活の先輩から譲り受け、引き継ぎました。その時はラズパイ内蔵でライトが光り、モーターが回っていましたが、レールの上は走っていませんでした。
先代ではラズベリーパイを使用していましたが大きすぎて、配線の都合で何故か起動もしなくなったのでArduinoというマイコンを使用しました。
しかし、ArduinoにはWi-Fi機能がないため基本外部との通信ができませんでした。そのため、下に書いた通り、赤外線信号を使用することにしました。</p><h2 id=全体像>全体像</h2><p>この改造では、PC、ArduinoMega、ArduinoUnoとその他諸々の部品を使いました。使用部品のすべては下に書いてあります。この3台の通信の関係は以下のようになります。</p><p><img src=./%E3%83%97%E3%83%A9%E3%83%AC%E3%83%BC%E3%83%AB%E6%94%B9%E9%80%A0%E9%80%9A%E4%BF%A1%E3%81%AE%E3%82%84%E3%82%8A%E5%8F%96%E3%82%8A.webp alt></p><p>赤外線通信や、シリアル通信については後ほど説明します。</p><h2 id=今回の改造での使用部品>今回の改造での使用部品</h2><p>今回使用した部品です</p><ul><li>プラレール<ul><li>Arduino Nano 1台</li><li>トランジスタ 2SC2120-Y 1台</li><li>LED4本と抵抗器4つ(前と後ろのLED)</li><li>9V型電池1つ</li><li>配線用の線と基盤 必要数</li></ul></li><li>信号装置側<ul><li>Arduino mega1台とそこに取り付ける自作シールド</li><li>信号装置ユニット(LED3つと照度センサー) 4組</li><li>専用線路(信号装置ユニットを取り付け、CdSセル各1つ) 4台</li><li>液晶モジュール <a href=https://amzn.asia/d/bCDdQ7B>1602A</a> 1台</li><li>ブレッドボード</li><li>ジャンパピン 必要なだけ</li><li>その他配線用導線 必要なだけ</li></ul></li></ul><h2 id=そもそもarduinoとは>そもそもArduinoとは</h2><p>Arduinoとは、マイコンの一種であり、デジタル入出力、アナログ入力、アナログ出力(PWM(パルス幅変調)を使ったデジタル出力)、USBを使ったシリアル通信などに対応しています。下の画像はArduinoの中でも一番有名なArduino Unoです。(Arduinoの画像3つは<a href=https://store.arduino.cc>Arduino公式ストア</a>からです。)</p><p><img src=UNO.webp alt="Arduino Uno"></p><p>しかし、これではプラレール本体に積み込むのには大きすぎます。そのため、今回プラレールの中に入れたのは下のArduinoNanoです。
<img src=NANO.webp alt="Arduino Uno">
こちらはUnoよりも小さいのですが、機能はほとんど変わらないので、便利です。しかし、部活には、Nanoの正規品がなかったので、ほぼ仕様が変わらない互換品を使用しました。
また、信号装置側では、信号ユニット4台、液晶モジュール1台、赤外線送信線1本、その他諸々をつなぎたいのですが、UnoやNanoにはデジタルピンが13本(正確には、アナログピンもデジタルピン扱いできるので、実質、18本ですが、ここでは面倒ですので割愛します。)しかないので、足りなくなりました。そのため、ピン数が、53本(デジタルピンのみでは)ある、ArduinoMegaを使いました。</p><p><img src=MEGA.webp alt="Arduino Uno"></p><h2 id=赤外線通信とは>赤外線通信とは</h2><p>今回は、信号装置からプラレールへの送信のために使用しました。赤外線通信とは目には見えない赤外線を高速で点滅させることにより、データを送信することです。それをArduinoでやろうとすると、高速に赤外線LEDを点滅させる必要があるうえ、他のプログラムとの同時実行を行う必要があり難易度が高いため、専用ライブラリを使用しました。それが、<a href=https://www.arduino.cc/reference/en/libraries/irremote/>IRremote</a>という赤外線通信用のライブラリです。これを使用することで赤外線信号を簡単に入出力できます。IRremoteは<a href=https://burariweb.info/electronic-work/arduino-learning/arduino-ir-module-use.html>参考にしたサイト</a>に合わせてバージョン2.8.1を使用しています。このライブラリでは、赤外線の受信、送信が可能で赤外線信号を16進数32ビットで管理していて容易に通信を行えます。</p><h2 id=シリアル通信について>シリアル通信について</h2><p>この改造ではPCとArduinoMegaとの接続に使用しました。厳密にいうと、シリアル通信をUSBに変換していますが、シリアル通信と同様に使用できます。ArduinoMegaでは、パソコンから送られてきた速度情報を赤外線信号にして、ArduinoUnoに渡す役割と、パソコンに自作した線路上のセンサーを使って取得した車両の位置を送信しています。シリアル通信については詳しくは<a href=https://qiita.com/hsgucci/items/eee5894e3651d0a8cb75>こちら</a>
を参考にしてほしいのですが、簡単に言うと、一本の信号線で電圧の強弱をもとにデータを送る方法です。</p><p><img src=./shiriaru.png alt></p><p><a href=https://qiita.com/hsgucci/items/eee5894e3651d0a8cb75>https://qiita.com/hsgucci/items/eee5894e3651d0a8cb75</a>から引用。パラレル通信については後ほど解説</p><p>ここでシリアル通信でArduinoMegaと接続しているPC側の説明をします。こちらは、Arduinoで使用しているC++(厳密にはArduinoではC++の拡張言語を使用)とは全然違うHTML+CSS+JavaScriptで操作しています。理由は、単純にJavaScriptのほうが環境構築が楽だったからです。webブラウザでも、chrome89から使用可能になったWebSerial APIを使うことでシリアル通信ができるので(詳しくは長くなるので説明しませんが、<a href=https://web.dev/i18n/ja/serial/>こちら</a>を参考してください)これを使用してシリアル通信を行っています。</p><h2 id=液晶モジュールについて>液晶モジュールについて</h2><p>今回使用した液晶モジュールは1602Aという型番のものです。
これをArduinoで制御するにはパラレル通信か、シリアル通信での接続が必要ですが、シリアル通信に必要な<a href=https://amzn.asia/d/1mzUWsf>専用の変換基板</a>がなかったのでパラレル通信にしました。シリアル通信は前述したとおりですが、パラレル通信は、複数の線で制御するしくみです。</p><p>パラレル通信によって液晶モジュールにたくさんArduinoのピンが取られてしまいましたが、ArduinoMegaにしたので問題はありませんでした。
液晶モジュールをArduinoで制御するには信号線4本(か8本)を制御する必要がありますが、難しいので、<a href=https://www.arduinolibraries.info/libraries/liquid-crystal>ここで</a>配布されている専用のライブラリを使用しました。
このライブラリは最初に設定(ライブラリを読み込み後、<code>LiquidCrystal(rs, rw, enable, d0, d1, d2, d3, d4, d5, d6, d7);</code>)をすれば、あとは対応する文字をそのまま関数の引数に書く(必要ならカーソル移動後に <code>lcd.print(表示したい文字);</code>)だけで制御できるので簡単です。</p><h2 id=自作線路の下にあるもの>自作線路の下にあるもの</h2><p>ArduinoMegaの車両位置を確認するため、4箇所に自作線路をつけました。</p><p><img src=./%E4%BF%A1%E5%8F%B7%E8%A3%85%E7%BD%AE_%E9%83%A8%E8%AA%8C%E6%8E%B2%E8%BC%89%E7%94%A8.webp alt></p><p>これには、信号機と、車両の通過を検出するセンサーが入っています。今回は、線路の下にセンサーを入れて、車両が通ると光が遮られ、暗くなるのを利用するために光センサー(CdSセル)を使用しました。光センサーは、明るさによって抵抗値が変わることを利用して、可変抵抗と同じ方法で値を取得しています。また、ArduinoMegaのアナログピンの近くにある電源関連のピンの本数不足が起こってしまったので簡易的なモジュールを作成しました。そこには、ピン数の拡張だけではなく、電源確認ランプ、リセットボタン、アナログ入力の際に必要になる抵抗装置を入れました。</p><p><img src=./%E8%87%AA%E4%BD%9C%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB_%E5%8D%98%E4%BD%93_%E9%83%A8%E8%AA%8C%E6%8E%B2%E8%BC%89%E7%94%A8.webp alt=自作モジュール></p><h2 id=内部配線について>内部配線について</h2><p>車両の前と後ろにLED各2本ずつと、モーター、Arduino、赤外線受信機、その他電源関連の基盤などを入れました。それぞれは下の図のように接続しました。</p><p><img src=./%E3%83%97%E3%83%A9%E3%83%AC%E3%83%BC%E3%83%AB%E4%B8%AD.webp alt></p><p>(こちらは夏休み時点の画像ですので文化祭では変更になっている可能性があります)
回路図は下のようになりました</p><p><img src=./%E3%83%97%E3%83%A9%E3%83%AC%E3%83%BC%E3%83%AB%E6%94%B9%E9%80%A0%E9%85%8D%E7%B7%9A%E5%9B%B3_%E5%9B%9E%E8%B7%AF%E5%9B%B3.webp alt></p><h2 id=モータードライバーについて>モータードライバーについて</h2><p><del>今までの物理部の部誌で何度か出てきたTA7291Pを使用しました。</del> モータードライバーを使おうと思って制作していたのですが、夏休みに原因不明の問題(多分、熱で壊したと思われる)が発生したため、トランジスタを使用しました。トランジスタの仕組みは<a href=https://deviceplus.jp/arduino/entry011/>https://deviceplus.jp/arduino/entry011/</a>を参考にしました。</p><h2 id=終わりに>終わりに</h2><p>ここまで今年で行った改造のほぼすべてを書きました。プラレール本体の改造はここに書いたとおりにやればできるはず(結構試行錯誤しないといけないところが出てくると思いますが)なので<del>ラズパイを壊す必要はありません</del>やってみたかったらやってください。(ただし、ここにある改造を行ったことで被ったすべての損害に対して責任を負いません)とても長くなりましたがここまで読んでいただいてありがとうございます。</p><h2 id=参考文献と本文中のリンク一覧>参考文献と本文中のリンク一覧</h2><ul><li>Arduino公式ストア
<a href=https://store.arduino.cc>https://store.arduino.cc</a></li><li>ライブラリ IRromote
<a href=https://www.arduino.cc/reference/en/libraries/irremote/>https://www.arduino.cc/reference/en/libraries/irremote/</a></li><li>赤外線通信プログラム時に参考にしたサイト
<a href=https://burariweb.info/electronic-work/arduino-learning/arduino-ir-module-use.html>https://burariweb.info/electronic-work/arduino-learning/arduino-ir-module-use.html</a></li><li>シリアル通信とは
<a href=https://qiita.com/hsgucci/items/eee5894e3651d0a8cb75>https://qiita.com/hsgucci/items/eee5894e3651d0a8cb75</a></li><li>web serial API
<a href=https://web.dev/i18n/ja/serial/>https://web.dev/i18n/ja/serial/</a></li><li>液晶モジュールのライブラリ
<a href=https://www.arduinolibraries.info/libraries/liquid-crystal>https://www.arduinolibraries.info/libraries/liquid-crystal</a></li><li>トランジスタの仕組み
<a href=https://deviceplus.jp/arduino/entry011/>https://deviceplus.jp/arduino/entry011/</a></li></ul></article><span class=next>次へ<a href=https://asanobuturi.github.io/document/2022/4/>ゼロから始めるコイルガン製作＞</a></span><br><span class=prev>前へ<a href=https://asanobuturi.github.io/document/2022/2/>Stable Diffusionをインストールしてお絵かきする＞</a></span></div><aside id=sidebar><nav id=sidemenu><div class=side-back><a href=../index.html>記事の一覧へもどる<img src=/image/icons/sign-out-alt-solid.svg class=inline-image></a></div><div class=side-prev><a href=https://asanobuturi.github.io/document/2022/2/><img src=/image/icons/angle-left-solid.svg class=inline-image>Stable Diffusionをインストールしてお絵かきする</a></div><div class=side-next><a href=https://asanobuturi.github.io/document/2022/4/>ゼロから始めるコイルガン製作<img src=/image/icons/angle-right-solid.svg class=inline-image></a></div></nav><section id=indexblock><header class=indextitle>目次</header><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#始めたきっかけ>始めたきっかけ</a></li><li><a href=#全体像>全体像</a></li><li><a href=#今回の改造での使用部品>今回の改造での使用部品</a></li><li><a href=#そもそもarduinoとは>そもそもArduinoとは</a></li><li><a href=#赤外線通信とは>赤外線通信とは</a></li><li><a href=#シリアル通信について>シリアル通信について</a></li><li><a href=#液晶モジュールについて>液晶モジュールについて</a></li><li><a href=#自作線路の下にあるもの>自作線路の下にあるもの</a></li><li><a href=#内部配線について>内部配線について</a></li><li><a href=#モータードライバーについて>モータードライバーについて</a></li><li><a href=#終わりに>終わりに</a></li><li><a href=#参考文献と本文中のリンク一覧>参考文献と本文中のリンク一覧</a></li></ul></nav></section></aside></main><footer id=footer><div class=section><nav class=grid><div><label class=headline>CONTENT</label><ul><li><a href=/>Home</a></li><li><a href=/document/>Docs</a></li><li><a href=/game/>Games</a></li><li><a href=/blog/>Blog</a></li><li><a href=/electronic/>Electronic</a></li></ul></div><div><label class=headline>CONTACT</label><ul><li><a target=_blank href=https://twitter.com/Uchi54_apc>Twitter</a></li><li><a target=_blank href=https://github.com/asanobuturi>GitHub Organization</a></li><li><a target=_blank href=https://github.com/asanobuturi/asanobuturi.github.io>Repository</a></li><li><a target=_blank href=https://github.com/asanobuturi/asanobuturi.github.io/issues>Issues</a></li></ul></div><div><label class=headline>ABOUT</label><ul><li><a href=/about/>About Us</a></li></ul></div></nav></div><hr><div class=section><p class=copyright>Copyright &copy; 2015 - 2023 Asano Physics Club, All Rights Reversed.</p><nav class=sns><a target=_blank href=https://twitter.com/Uchi54_apc><svg xmlns="http://www.w3.org/2000/svg" fill="currentcolor" viewBox="0 0 248 204"><path d="M221.95 51.29c.15 2.17.15 4.34.15 6.53.0 66.73-50.8 143.69-143.69 143.69v-.04c-27.44.04-54.31-7.82-77.41-22.64 3.99.48 8 .72 12.02.73 22.74.02 44.83-7.61 62.72-21.66-21.61-.41-40.56-14.5-47.18-35.07 7.57 1.46 15.37 1.16 22.8-.87-23.56-4.76-40.51-25.46-40.51-49.5v-.64c7.02 3.91 14.88 6.08 22.92 6.32C11.58 63.31 4.74 33.79 18.14 10.71c25.64 31.55 63.47 50.73 104.08 52.76-4.07-17.54 1.49-35.92 14.61-48.25 20.34-19.12 52.33-18.14 71.45 2.19 11.31-2.23 22.15-6.38 32.07-12.26-3.77 11.69-11.66 21.62-22.2 27.93 10.01-1.18 19.79-3.86 29-7.95-6.78 10.16-15.32 19.01-25.2 26.16z"/></svg></a><a target=_blank href=https://github.com/asanobuturi><svg class="w-5 h-5" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483.0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951.0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65.0.0.84-.27 2.75 1.026A9.564 9.564.0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688.0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855.0 1.338-.012 2.419-.012 2.747.0.268.18.58.688.482A10.019 10.019.0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/></a></nav></div></footer></body></html>