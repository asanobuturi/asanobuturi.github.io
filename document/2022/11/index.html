<!doctype html><html lang=ja><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="部内サーバーをつくったというおはなし!"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/styles.min.css><link rel=icon href=/image/favicon.svg type=image/svg+xml><link rel="icon alternate" href=/image/favicon.ico><meta property="og:site_name" content="浅野学園物理部"><meta property="og:url" content="https://asanobuturi.github.io/document/2022/11/index.html"><meta property="og:title" content="部内で鯖を飼育する｜浅野学園物理部"><meta property="og:description" content="部内サーバーをつくったというおはなし!"><meta property="og:type" content="website"><meta property="og:image" content="https://asanobuturi.github.io/document/2022/11/thumbnail.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@Uchi54_APC"><title>部内で鯖を飼育する｜浅野学園物理部</title><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML"></script><link rel=stylesheet href=/css/highlight.min.css><link rel=stylesheet href=/css/article.min.css><link rel=stylesheet href=/css/tableOfContents.min.css></head><body><div id=nav-drawer><input id=nav-input type=checkbox class=nav-unshown>
<label id=nav-open for=nav-input><span class="bar bar1"></span><span class="bar bar2"></span><span class="bar bar3"></span><span class=menu>MENU</span>
<span class=close>CLOSE</span></label>
<label id=nav-close for=nav-input></label><div id=nav-content><a href=/index.html><img loading=lazy src=/image/favicon.svg id=nav-logo alt=浅野学園物理部></a>
<a class=nav-link href=/index.html>ホーム</a>
<a class=nav-link href=/about/index.html>物理部とは</a>
<a class="nav-link isActive" href=/document/index.html>部誌</a>
<a class=nav-link href=/game/index.html>ゲーム</a>
<a class=nav-link href=/blog/index.html>ブログ</a>
<a class=nav-link href=/electronic/index.html>電工の部屋</a><div class=nav-separator></div><a class=nav-link href=/credit/index.html>クレジット(ライセンス)</a></div></div><main><a name=top></a><div id=main><div class=documentcontent><div id=breadcrumbs><a href=/index.html><img src=/image/icons/home-solid.svg class=inline-image>ホーム</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/>部誌</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/2022/>2022年度・部誌</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/2022/11/>部内で鯖を飼育する</a></div><header class=documenttitle><h1 id=title>部内で鯖を飼育する</h1><p class=author><img src=/image/icons/user-edit-solid.svg class=inline-image>高二 Y.K.</p><div class=share><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class=twitter-share-button data-related=Uchi54_apc data-lang=ja data-show-count=false>Tweet</a>
<script async src=https://platform.twitter.com/widgets.js></script></div></header><div class=document><h2 id=鯖生き物ではない>鯖（生き物ではない）</h2><blockquote><h2 id=鯖>鯖</h2><p>サーバー(server)コンピューターのこと。コンピューター・ネットワーク上でクライアントから受けたリクエストに対し、様々なサービスを提供するシステム。
<em>&ndash;(株)朝日新聞出版発行「知恵蔵」より</em></p></blockquote><p>もちろん生き物の鯖ではありません。物理部の劣悪な環境下では魚の鯖はおそらく飼育不可能でしょう。</p><h2 id=鯖を飼う理由>鯖を飼う理由</h2><p>物理部ではいままで部員にWindows搭載ノートパソコン等を購入することを部員に推奨してきました。これは物理部の限られた部費で部員全員分のコンピューターを用意するのが困難なためです。実は物理部の部員は100人ほどいます。<del>なお部活出席率は</del>普段から部活にいる20人分のコンピューターを部活動が負担するのは到底不可能です。データをローカルに保存する都合上、毎回の部活で利用するコンピューターが固定されることになります。国税庁が言うにはコンピューターも消耗品、耐用年数は5年とされています。プログラミングや動画編集などを行う都合上ある程度のマシンパワーが必要になってくるため1台当たりの値段はかなり高額になります。
そこで考えたのは「部内にNASを立ててそこにデータを保管する」というものでした。しかし市販のNASを買って設置するだけでは面白みに欠けます。そんなわけで部内にファイルサーバーを建てるという結論に(自分の中で)達しました。</p><h2 id=鯖の品種パーツの選定>鯖の品種（パーツ）の選定</h2><p>サーバーたるものやっぱり常時起動は見据えなければなりません。また浅野学園では生徒は学校のネットワークを利用するのを利用することは禁じられているため、部内ネットワークを立てる必要も出てきました。</p><ol><li>CPU</li><li>マザーボード</li><li>メモリー</li><li>SSD</li><li>グラフィックカード</li><li>電源</li><li>ケース</li><li>オペレーティングシステム</li><li>Wi-Fiルーター</li></ol><p>それぞれ選定品とその理由を説明できればと思います。またCPU～グラフィックボードは実店舗で購入できるかどうかも判断材料に含まれます。</p><ol><li><strong>CPU</strong> 　今回はIntel Corei3 10105を選択しました。理由は簡単。現行のCoreシリーズで一番省電力だから。サーバーなのでやっぱり電力は気になります。市販のNASではCeleronなどが一般的ですが、将来的にサーバーからデスクトップコンピューターに生まれ変わることも見据えて Core i3を選択しました。</li><li><strong>マザーボード</strong> 　ツクモでメモリースロットが4本で一番安かったASRockのH570M Pro4を選択しました。<del>無駄に光ります</del></li><li><strong>メモリー</strong> 　メモリーはファイルサーバーで割とこだわるべき場所な気はします。無難に8GB2枚組です。</li><li><strong>SSD</strong> 　ファイルサーバーでかなり重要な場所です。これを適当に決めてしまうと故障によってファイルの消失もあり得ます。今回はシステムドライブとデータドライブを分けることにしました。システムドライブはADATAのSATA120GB、データドライブは信頼性と速度を重視しKIOXIAのM.2 1TBモデルを選択しました。</li><li><strong>グラフィックカード</strong> 　所詮ファイルサーバーなので高性能なものは必要ありません。当初はCPUは内蔵グラフィックなしの下位モデルを選択し、日本最安グラフィックカードのGT710を使用しようかと思いましたがツクモに行ったところCPUの価格差があまりなかったので内臓グラフィック搭載のCPUを選びました。強いて言うならIntel UHDグラフィック630でしょうか。</li><li><strong>電源</strong> 　これはサーバーで一番おろそかにしてはいけないものじゃないでしょうか。激安の電源ユニットを利用して発火したら洒落になりません。比較的安め、ある程度の信頼はできる玄人志向の450W電源を選びました。</li><li><strong>ケース</strong> 　別にケースは性能に直結しないのでどんなものを選んでもいいのですが、物理部は収納スペースの都合上スチールラックの上に設置することになったので横置きケースを選ばざるを得ませんでした。これで地震が来ても大丈夫(なはず)。</li><li><strong>オペレーティングシステム</strong> 　ファイルサーバーとして運用する都合上管理は簡単なほうがいいに決まってます。そのほうが引き継ぎも楽です。詳細は後ほど。</li><li><strong>Wi-Fiルーター</strong> 　サーバー設置場所と物理部の普段の活動場所との間には鉄製の扉が2枚あります。そのためアンテナが本体から飛び出しているもの且つWi-Fi6に対応していて、ちょうど購入時にAmazonセールで安かったTPLINK AX4800を購入しました。</li></ol><h2 id=鯖のos>鯖のOS</h2><p>オペレーティングシステム、これはかなり迷いました。ubuntuを利用してもよかったのですが、後輩への引き継ぎが困難を極めると予想したため、データ保管サーバー用のOSとしては定番なOpenmediavaultで環境を構築しました。このOSはWeb上で簡単に操作できるのが特徴です。やっぱり操作しやすいのはいいですね。</p><h2 id=トラブル>トラブル</h2><p>OpenMediaVaultをインストールした後にトラブルが発生しました。それは「OpenMediaVaultがIntel I219-Vを認識してくれない」というものでした。Intel I219-VはマザーボードのRJ45(=LANコネクタ)の端子です。調べてみるとOpenMediaVaultを導入する前にUbuntuをインストールし、I219-Vのドライバーを導入しないといけないらしい。いまさら再インストールするのは時間がかがりすぎると感じたので、SSDのみI219-Vを搭載していないPCで起動させ、そこで初期設定のみ進めることにしました。インターネットに繋げられないのですばらしいWeb操作も一切できません。ずっと黒い画面とにらめっこ。<del>精神的にもつらい。</del></p><h2 id=ファイル構成>ファイル構成</h2><p>前述の通りこのサーバーにはデータドライブとして1TBのSSDがあります。そこで今回は以下のように割り振るようにしました。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>KIOXIA 1TB SSD
　├ goole drive backup -250GB
　└ data -750GB
</code></pre></td></tr></table></div></div><p>google drive backupは物理部の共有ドライブの内容をクローンする予定でしたが、時間がないので後輩に頑張ってもらいます。
割り当てさえ決まったらあとはSMBを有効にしてPCからログインするだけです。</p><h2 id=構築完了>構築完了</h2><p>CrystalDiskMarkで転送速度を計測してみました。
<img src=https://yamajikai.jp/cdm.png alt>{height=200}</p><p>1Gbpsで優先接続だとこんな感じ。1Gbpsの転送速度上限が125Mb/sなんですけど超えてるのは何なんでしょう。。。画像はないですが2.4Ghzでのアクセス時でRead20Mbps、5Ghzアクセス時は40Mbps程度とまずますの結果です。
普段はArduinoのスケッチを読み出しするだけだと思うので、かなり過剰設備ではありますが何とか完成してよかったです。</p><p>ちなみに完成してから1週間後に再度OpenMediaVaultがI219-Vを認識しなくなったのはまた別のお話&mldr;</p><h2 id=special-thanks>Special Thanks</h2><ul><li>予算を下ろしてくれた顧問の先生</li><li>OpenMediaVault Forum &ldquo;Network problem with Intel I219-V when installing OMV6&rdquo;</li></ul></div><nav class=nextPrev><div class=next>次へ<a href=https://asanobuturi.github.io/document/2022/12/>編集後記＞</a></div><div class=next>前へ<a href=https://asanobuturi.github.io/document/2022/10/>自作OSで文字列をPC98に表示する＞</a></div></nav></div><nav id=sidebar><div id=sidemenu><div class=side-back><a href=../index.html>記事の一覧へもどる<img src=/image/icons/sign-out-alt-solid.svg class=inline-image></a></div><div class=side-prev><a href=https://asanobuturi.github.io/document/2022/10/><img src=/image/icons/angle-left-solid.svg class=inline-image>自作OSで文字列をPC98に表示する</a></div><div class=side-next><a href=https://asanobuturi.github.io/document/2022/12/>編集後記<img src=/image/icons/angle-right-solid.svg class=inline-image></a></div></div><div id=indexblock><div class=indextitle>目次</div><ol class=indexcontents><nav id=TableOfContents><ul><li><a href=#鯖生き物ではない>鯖（生き物ではない）</a></li><li><a href=#鯖>鯖</a></li><li><a href=#鯖を飼う理由>鯖を飼う理由</a></li><li><a href=#鯖の品種パーツの選定>鯖の品種（パーツ）の選定</a></li><li><a href=#鯖のos>鯖のOS</a></li><li><a href=#トラブル>トラブル</a></li><li><a href=#ファイル構成>ファイル構成</a></li><li><a href=#構築完了>構築完了</a></li><li><a href=#special-thanks>Special Thanks</a></li></ul></nav></ol></div></nav></div><footer class=footer><p class=copyright>Copyright &copy; 2015 - 2022 Asano Physics Club, All Rights Reversed.</p><p class=note></p></footer></main></body></html>