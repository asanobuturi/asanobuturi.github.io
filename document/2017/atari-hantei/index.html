<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115439668-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
          dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'UA-115439668-1');
  </script>

  <meta property="og:url" content="https://asanobuturi.github.io/document/2017/atari-hantei/index.html"/>
  <meta property="og:title" content=""落ちる"動きと当たり判定のプログラミングについて|浅野学園物理部"/>
  <meta property="og:description" content=""/>
  <meta property="og:type" content="website"/>
  <meta property="og:image" content="https://asanobuturi.github.io/document/2017/atari-hantei/thumbnail.jpg"/><!--ここまでOGP設定-->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@Uchi54_APC" /> <!--ここまでTwitterカード設定-->

  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML' async></script><!--MathJax適用(LaTeX数式表示用)-->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta name="description" content="2Dアクションゲームの物理について解説します" />

  <title>"落ちる"動きと当たり判定のプログラミングについて|浅野学園物理部</title>

  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/blog_new.css">
  <link rel="stylesheet" href="/highlight.css"><!--シンタックスハイライト-->
  <link rel="shortcut icon" href="/image/favicon.ico">

  <script type="text/javascript" src="//typesquare.com/accessor/script/typesquare.js?YME8OdI00sA%3D" charset="utf-8"></script>
  <script src="https://kit.fontawesome.com/1e291c4f9b.js" crossorigin="anonymous"></script>

</head>
<body>
  <div id="nav-drawer">
  </div>
  <main>
    <div id="main">
        <div class="documentcontent"><article>
            <div id="breadcrumbs">
                <i class="fas fa-home"></i><a href="/index.html">ホーム</a><i class="fas fa-angle-right"></i><a href="/document.html">部誌</a><i class="fas fa-angle-right"></i><a href="../index.html">2017年度部誌</a><i class="fas fa-angle-right"></i>"落ちる"動きと当たり判定のプログラミングについて
            </div>
            <header class="documenttitle">
                <h1>"落ちる"動きと当たり判定のプログラミングについて</h1>
                <p class="author"><i class="fas fa-user-edit"></i>高一 Y</p>
                <a href="https://twitter.com/intent/tweet?url=https://asanobuturi.github.io/document/2017/atari-hantei/index.html&text="落ちる"動きと当たり判定のプログラミングについて|浅野学園物理部&via=Uchi54_APC&related=Uchi54_APC" class="twitter-share-button" data-show-count="false">Tweet</a>
                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><!--Twitterのシェアボタンの中身(URL・記事タイトル)も記述すること-->
            </header>
            <div class="document">
              <p>こんにちは。ここでは、2Dのアクションゲームがどのように動いているか、簡単に見てみたいと思います。ここで説明しているのは、2Dのアクションゲームを作るにあたって、ほぼ自分で考えたものなので、実際の物とは全く異なるかもしれませんが、どのようにゲーム が動いているのか少しでもわかってもらえればと思っています。</p>
              <h2 id="フレームとは">フレームとは？</h2>
              <p>まずは、「フレーム」について説明します。</p>
              <p>実は、パソコン・スマホ・テレビなどの映像は、1秒間に数十枚の画像を表示して、動いているように見せています。ゲームでも、1秒間に60枚の画像(1枚あたり1/60秒)を入れ替えることが多いです。そして、その1枚1枚の画像のことを、「フレーム」といいます。ふつう、ゲーム内では、1/60秒の間に次の画像を用意して、1/60秒経ったら入れ替えて・・・ということを繰り返しています。</p>
              <h2 id="落ちる動きについて">落ちる動きについて</h2>
              <p>次に、重力について説明したいと思います。</p>
              <p>例えば、ゲームで高いところから落ちると下に落ちますよね。この動き方を作るのは簡単そうに思えますが、実は少し難しいのです。 単純に、1フレーム当たり1ずつ下に落とすようにすると変な動き方になってしまいます。物を落としたとき、加速度は一定だから、物 体の速度は時間に比例して大きくなっていくので、1フレーム目は1、2フレーム目は2、3フレーム目は3ずつ落ちるようになります。そうすることで本当に落ちているように見えます。では、ジャンプもさせてみましょう。1フレーム目は10上に、2フレーム目は9上に、11フレーム目は0、12フレーム目からは落ちる動きと同じようにしてみると、うまくジャンプできます。</p>
              <p>(少しプログラミング的なことを言うと、例えば、重力の変数gを用意しておいて、gには1フレーム当たり0.3ずつ増やし、プレイヤーのy座標に1フレームずつgを足して、ジャンプのキーが押されたときにgを-20にするとジャンプができます。)</p>
              <h2 id="当たり判定について">当たり判定について</h2>
              <p>最後に、当たり判定について説明したいと思います。</p>
              <p><img src="1.jpg" /></p>
              <p>当たり判定と言っても色々ありますが、ここでは、1つの正方形のブロックと、長方形のプレイヤーとの当たり判定について説明していきます。これも、簡単そうに見えて実は難しいのです。どうしてかというと現実世界では、ものが動くとき、連続的に動きますが、ゲームでは1/60秒ごとにプレイヤーを動かしているので、連続的には動きません。プレイヤーがブロ ックに当たったら止めるという処理だけだと、ブロックに埋まってしまいます。そこで、ブロックに埋まったら押し出すという処理が必要になります。ここでは、その押し出しをどのように実装したか、説明したいと思います。</p>
              <p>まず、あるフレームでプレイヤーがブロックに当たったとしましょう。その1つ前のフレームで、プレイヤーがどこに居たかで場合分けをします。</p>
              <p>(1)1つ前のフレームで、ブロックよりも上にいた場合</p>
              <p>この1フレームの間に、ブロックの上側の辺に当たった可能性が高いので、プレイヤーをブロックの上側に持ってくる。</p>
              <p><img src="2.jpg" /></p>
              <p>(2)1つ前のフレームで、ブロックより下にいた場合</p>
              <p>この1フレームの間に、ブロックの下側の辺に当たった可能性が高いので、プレイヤーをブロックの下側に持ってくる。</p>
              <p><img src="3.jpg" /></p>
              <p>(3)それ以外のとき(図の2本の横線のどちらかにあたっていた、またはその間に入っていたら)</p>
              <p>〈1〉1つ前のフレームで、ブロックより左側にいたら</p>
              <p>この1フレームの間に、ブロックの左側の辺に当たったのプレイヤーをブロックの左側に持ってくる。</p>
              <p>〈2〉1つ前のフレームで、ブロックより右側にいたら</p>
              <p>この1フレームの間に、ブロックの右側の辺に当たったので、プレイヤーをブロックの右側に持ってくる。</p>
              <p>〈3〉それ以外のとき(1つ前のフレームも埋まっていたら)1つ前のフレームで埋まったのに押し出せていない?</p>
              <p>このような場合分けをしてみたところ、それっぽく動きました。</p>
              <p><img src="4.jpg" /></p>
              <p>では､ブロックがたくさんあるときはどうでしょう。単純に、それぞれのブロックに対して同じことをすると、例えば図のようにプレイヤーが動いたとき上の当たり判定の方法でやって見ましょう。一番上のブロックで押し出しをやってみると、1フレーム前のプレイヤーは一番上のブロックより下にいたので、ブロックの下側に持って行きます。そして、二番目のブロックでは、1フレーム前のプレイヤーは左側にいたのでブロックの左に持っていきます。すると、ブロックが縦に並んで壁のようになって、左側にしか当たりそうにないの に、その壁のブロックに頭をぶつけたようになってしまいます。</p>
              <p><img src="5.jpg" /></p>
              <p>そうならないように、ブロックがたくさんある場合は、先にすべて左 右の当たり判定をしてから、そのあと、すべての上下の当たり判定をします。</p>
              <p>というわけで、少し説明してみましたが、どうでしたか。分かりにくいところもあったと思いますが、少しでも、ゲームがどのように動いているのか興味を持ってくれたらうれしいです。ここまで読んでいただきありがとうございました。</p>
            </div>
            <nav class="nextPrev">
                <div class="prev">前へ<a href="../aisatsu/index.html">「御挨拶」
                        &gt;</a></div>
                <div class="next">次へ<a href="../auto-music-sequencer/index.html">「自動演奏装置について」
                        &gt;</a></div>
            </nav>
        </article></div>
        <nav id="sidebar">
            <div id="sidemenu">
                <div class="side-back"><a href="../index.html">記事の一覧へもどる<i class="fas fa-sign-out-alt"></i></a></div>
                <div class="side-prev"><i class="fas fa-angle-left"></i><a href="../aisatsu/index.html">「御挨拶」</a></div>
                <div class="side-next"><a href="../auto-music-sequencer/index.html">「自動演奏装置について」</a><i class="fas fa-angle-right"></i></div>
            </div>
            <div id="indexblock">
                <div class="indextitle">目次</div>
                <ol class="indexcontents">
                    <ul>
                    <li><a href="#フレームとは">フレームとは？</a></li>
                    <li><a href="#落ちる動きについて">落ちる動きについて</a></li>
                    <li><a href="#当たり判定について">当たり判定について</a></li>
                    </ul>
                </ol>
            </div>
        </nav>
    </div>
    <footer class="footer">
        <div class="">
            <p class="copylight">&copy; 2015-2017 Asano Physics Club</p>
        </div>
    </footer>
</main>
<script type="text/javascript" src="/general.js"></script>
</body>
</html>
