<!doctype html><html lang=ja><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="弾幕シューティングゲームをつくろう！"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/scss/styles.min.4a71567d35f0565714f9b264f620dd2c5abcdd3fd6d8bc1fe2bafa8114c2fe47.css><link rel=icon href=/image/favicon.svg type=image/svg+xml><link rel="icon alternate" href=/image/favicon.ico><meta property="og:site_name" content="浅野学園物理部"><meta property="og:url" content="https://asanobuturi.github.io/document/2016/8/index.html"><meta property="og:title" content="弾幕の作り方｜浅野学園物理部"><meta property="og:description" content="弾幕シューティングゲームをつくろう！"><meta property="og:type" content="website"><meta property="og:image" content="https://asanobuturi.github.io/document/2016/8/thumbnail.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@Uchi54_APC"><link rel=canonical href=https://asanobuturi.github.io/document/2016/8/><script async src="https://www.googletagmanager.com/gtag/js?id=G-M4YH1E5WC1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag("js",new Date());gtag("config","G-M4YH1E5WC1");</script><title>弾幕の作り方｜浅野学園物理部</title><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel=stylesheet href=/scss/highlight.min.9b4082acf90ec245e99e303a9e09c0a4ffa77b9754c98965a6bdb067c39e9c14.css><link rel=stylesheet href=/scss/article.min.5ab46a9154b676996cd1867b86fa75a6f6dfd4cf58534c093b363ff6739f3f03.css><link rel=stylesheet href=/scss/tableOfContents.min.603245923695f62c9be0618c1b6a10599acbf0f4f5056ffe631acd014b70fd17.css></head><body><nav id=nav-drawer><input id=nav-input type=checkbox class=nav-unshown>
<label id=nav-open for=nav-input><span class="bar bar1"></span><span class="bar bar2"></span><span class="bar bar3"></span><span class=menu>MENU</span>
<span class=close>CLOSE</span></label>
<label id=nav-close for=nav-input></label><div id=nav-content><a href=/index.html><img loading=lazy src=/image/favicon.svg id=nav-logo alt=浅野学園物理部></a>
<a class=nav-link href=/index.html>ホーム</a>
<a class=nav-link href=/about/index.html>物理部とは</a>
<a class="nav-link isActive" href=/document/index.html>部誌</a>
<a class=nav-link href=/game/index.html>ゲーム</a>
<a class=nav-link href=/blog/index.html>ブログ</a>
<a class=nav-link href=/electronic/index.html>電工の部屋</a><hr><a class=nav-link href=/credit/index.html>クレジット(ライセンス)</a></div></nav><main><div id=content><a name=top></a><div id=breadcrumbs><a href=/index.html><img src=/image/icons/home-solid.svg class=inline-image>ホーム</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/>部誌</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/2016/>2016年度・部誌</a>
<img src=/image/icons/angle-right-solid.svg class=inline-image>
<a href=/document/2016/8/>弾幕の作り方</a></div><header id=overview><h1 id=title>弾幕の作り方</h1><div><div class=properties><span class=author><img src=/image/icons/user-edit-solid.svg class=inline-image>
スパゲッティソース</span></div><div class=share><span><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class=twitter-share-button data-related=Uchi54_apc data-lang=ja data-show-count=false>Tweet</a>
<script async src=https://platform.twitter.com/widgets.js></script></span></div></div></header><article><p>皆さんこんにちは。作者名のスパゲッティソースというのは“スパゲッティみたいにこんがらかっていて読みにくいソースコード”という意味である。そんなソースコードを書く人がこんな部誌を書いていることを気にしたら負けである。</p><p>本題に入るが、弾幕とは簡単に言えば弾の複数形である。つまりゲームで敵が撃ってくる弾をどうやって作るのかを解説する。またこの部誌は<b>C言語</b>および<b>C++</b>を基調としている。それ以外の言語では違うところが多々あると思うので、注意してほしい。</p><p>まずはグラフィックの調達だ。一般の企業が出しているようなクオリティの高いものでなければペイントで十分である。事実私も多用している。また透明化するソフトも必要だがそれは無料ソフト“手軽に透明”を私は使っている。透明化しかできないが十分である。どうしてもそれらができない場合は簡単な図形であれば描画する機能がC言語についているのでそれを使えば問題ない。ただし、少し処理が重くなることは考慮する必要がある。</p><p>次にソースコードを書いていく。まず、配列と呼ばれるものを用いてたくさんの変数を作る。といってもわからないであろうから、順に説明していく。まず、変数というのは箱みたいなものである。そこには数値をひとつ入れることができる。言い換えるとひとつしか入らない。であるがゆえにたくさん作る必要があるのだが、そのことはひとまず置いておいて、変数についてもう少し詳しく説明していく。ひとつしか数値が入らない変数に二つ目の数字を入れるとどうなるか、一つ目の数字が消えるのである。そこも使いやすい点であるのだが、それを知らないと混乱してしまうであろう。さらに、すべての数を入れられるわけではないということである。よく使われる変数の型であるINT型は-2147483468~2147483467までの<b>整数</b>しか入らない。小数を扱うならFLOAT型で約±3.4×10の38乗までで有効桁は7桁となっている。FLOAT型の方が多くの数を入れられるため便利に見えるが、その分多くのメモリを使う上に、“3で割った余りを求める”という時にも使えないので適材適所で使う必要がある。他にもたくさんの型があるが、私はこれ以外にほとんど使ったことがないのでこれだけあれば十分である。興味があれば調べてみても構わないが。</p><p>変数についてわかったところで、配列の説明に入る。難しく聞こえるかもしれないがなんてことはない。変数の複数形だと思えば良い。それを<code>floatbulletx[1024];</code>などとすればよい。これは弾のX座標の配列の例である。つまり最低でももう一つ<code>floatbullety[1024];</code>が必要である。それ以外にも弾が様々な方向に飛ぶとすれば、その向きと速度の配列（もしくは移動方向のXとYの長さ）が必要である。ちなみに私は括弧内の方を使っているのだが、意味がわからない人は図１を見てほしい。また、1024というのは表示できる弾幕数の最大値となる。</p><p><img src=1.png alt></p><p>それでは数値を代入していこう。例えば「にゃにゃめにゃにゃじゅうにゃにゃどのにゃらびでにゃにゃつのたまを（にゃにゃ,にゃにゃ）からはにゃつ」（斜め77度の並びで7つの弾を（7,7）から放つ）為にはどうすればよいか。ちゃんと説明しようと思うと三角関数（sin,cos,tan）や弧度法（ラジアン）が必要だが、まだ習っていない人のために簡単に言うとコンピューターに77度の三角形の縦、横、斜めの長さを計算させるだけである。それらがわかっている人にとっては本当にそれだけでいいの？と思うかもしれないが、コンピューターは計算がだーいすきなので、がっつりお仕事してもらおう。当然それらを相似拡大する必要があるが、ここまで読んだ人ならわかるであろう。ちなみに（7,7）から77度の角度で弾を放つとすぐに画面外に出て消えてしまうので、-77度で弾速7で7フレームおきに放ってもらおう。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>/*初期化処理など*/</span>
<span style=color:#66d9ef>int</span> a<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span>;
<span style=color:#66d9ef>int</span> x; <span style=color:#75715e>//一時的に弾の x 座標を保存するための変数
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> y; <span style=color:#75715e>//一時的に弾の y 座標を保存するための変数
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> i;
<span style=color:#66d9ef>int</span> gametime<span style=color:#f92672>=-</span><span style=color:#ae81ff>1</span>; <span style=color:#75715e>//ゲームが始まってからの時間
</span><span style=color:#75715e></span><span style=color:#66d9ef>float</span> pi<span style=color:#f92672>=</span><span style=color:#ae81ff>3.141592</span>; <span style=color:#75715e>//円周率。ラジアンに変換する時に使う float bulletx[8];//今回は 8 個もあれば十分ですね。（以下同様） float bullety[8];
</span><span style=color:#75715e></span><span style=color:#66d9ef>float</span> bulletx2[<span style=color:#ae81ff>8</span>];
<span style=color:#66d9ef>float</span> bullety2[<span style=color:#ae81ff>8</span>];
<span style=color:#75715e>/*初期化処理など 2*/</span>
<span style=color:#66d9ef>int</span> white<span style=color:#f92672>=</span>GetColor(<span style=color:#ae81ff>255</span>,<span style=color:#ae81ff>255</span>,<span style=color:#ae81ff>255</span>);<span style=color:#75715e>//白い色
</span><span style=color:#75715e></span><span style=color:#66d9ef>while</span>(ProcessMessage()<span style=color:#f92672>!=-</span><span style=color:#ae81ff>1</span>){<span style=color:#75715e>//エラーがない限りループする gametime++; //gametime に１を足す
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>(gametime<span style=color:#f92672>%</span><span style=color:#ae81ff>7</span><span style=color:#f92672>==</span><span style=color:#ae81ff>0</span>){<span style=color:#75715e>//もし gametime を 7 で割った余りが 0 だったら a++;
</span><span style=color:#75715e></span>        bulletx[a]<span style=color:#f92672>=</span><span style=color:#ae81ff>7</span>; <span style=color:#75715e>//bulletx[a]に 7 を代入
</span><span style=color:#75715e></span>        bullety[a]<span style=color:#f92672>=</span><span style=color:#ae81ff>7</span>;
        bulletx2[a]<span style=color:#f92672>=</span><span style=color:#ae81ff>7</span><span style=color:#f92672>*</span>sin(<span style=color:#f92672>-</span><span style=color:#ae81ff>77</span><span style=color:#f92672>*</span>pi<span style=color:#f92672>/</span><span style=color:#ae81ff>180</span>); <span style=color:#75715e>//斜辺が 7、角度が-77 度の横の長さ bullety2[a]=7*cos(-77*pi/180);
</span><span style=color:#75715e></span>    }
    <span style=color:#66d9ef>for</span>(i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>8</span>;i<span style=color:#f92672>++</span>){ <span style=color:#75715e>//8 回ループ
</span><span style=color:#75715e></span>        bulletx[i]<span style=color:#f92672>+=</span> bulletx2[i];
        bullety[i]<span style=color:#f92672>+=</span> bullety2[i];
        x<span style=color:#f92672>=</span>bulletx[i]; <span style=color:#75715e>//小数点以下を切り捨てて整数値に
</span><span style=color:#75715e></span>        y<span style=color:#f92672>=</span>bullety[i];
        DrawCircle(bulletx[i],bullety[i],<span style=color:#ae81ff>7</span>,white,TRUE); <span style=color:#75715e>//半径7の円を描画
</span><span style=color:#75715e></span>    }
If(gametime<span style=color:#f92672>&gt;=</span><span style=color:#ae81ff>42</span>){<span style=color:#66d9ef>break</span>;}<span style=color:#75715e>//弾を 7 つ放ち終わる時間になったら終了
</span></code></pre></td></tr></table></div></div><p>概ねこんなかんじである。かなりはしょって書いたのでほとんどの人はわからないだろうが、興味を持ってくれたら幸いである。一応全然わかってない人のために言っておくが、「初期化処理など」のところを書いていないためこれをコンパイルしても動かない。加えてこれだと7つ目の弾を放った瞬間に終わるので、その弾は見えて一瞬である。さらに実行し始めてから0.7秒ほどで終わってしまう。配列の数を増やしてbreakを外せばしばらくの間はちゃんと動いてくれるだろう。存在しない箱を指定するとバグが発生するのでbreakだけ外してそれを楽しむのもまた一興であろう。私はこれよりも作るのが難しい弾幕に自機との当たり判定をつけ、さらに被弾時処理、ショット、ボムその他もろもろをたった一人で書き上げたのだ。しかしそれでも企業が出すようなゲームには到底及ばない。私が参考にしたゲームは私と同様一人で作成しているが、プログラミングだけでなくグラフィック、音楽までもちゃんと作り、エフェクトなども私のものよりはるかに上である。私たちの身近にあるゲーム。塾や親、学校の先生などは「勉強の敵」などと言うかもしれないが、作る視点に立ってみると、非常に難しく、多くのことを学べる分野である。それをただ否定するのはどうかと思う。（おっ、俺いいこと言った）</p></article><span class=next>次へ<a href=https://asanobuturi.github.io/document/2016/9/>落下る＞</a></span><br><span class=prev>前へ<a href=https://asanobuturi.github.io/document/2016/7/>スマホ世代の為のパソコン活用の心得＞</a></span></div><aside id=sidebar><nav id=sidemenu><div class=side-back><a href=../index.html>記事の一覧へもどる<img src=/image/icons/sign-out-alt-solid.svg class=inline-image></a></div><div class=side-prev><a href=https://asanobuturi.github.io/document/2016/7/><img src=/image/icons/angle-left-solid.svg class=inline-image>スマホ世代の為のパソコン活用の心得</a></div><div class=side-next><a href=https://asanobuturi.github.io/document/2016/9/>落下る<img src=/image/icons/angle-right-solid.svg class=inline-image></a></div></nav><section id=indexblock><header class=indextitle>目次</header>なし</section></aside></main><footer id=footer><div class=section><nav class=grid><div><label class=headline>CONTENT</label><ul><li><a href=/>Home</a></li><li><a href=/document/>Docs</a></li><li><a href=/game/>Games</a></li><li><a href=/blog/>Blog</a></li><li><a href=/electronic/>Electronic</a></li></ul></div><div><label class=headline>CONTACT</label><ul><li><a target=_blank href=https://twitter.com/Uchi54_apc>Twitter</a></li><li><a target=_blank href=https://github.com/asanobuturi>GitHub Organization</a></li><li><a target=_blank href=https://github.com/asanobuturi/asanobuturi.github.io>Repository</a></li><li><a target=_blank href=https://github.com/asanobuturi/asanobuturi.github.io/issues>Issues</a></li></ul></div><div><label class=headline>ABOUT</label><ul><li><a href=/about/>About Us</a></li></ul></div></nav></div><hr><div class=section><p class=copyright>Copyright &copy; 2015 - 2023 Asano Physics Club, All Rights Reversed.</p><nav class=sns><a target=_blank href=https://twitter.com/Uchi54_apc><svg class="w-5 h-5" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.29 20.251c7.547.0 11.675-6.253 11.675-11.675.0-.178.0-.355-.012-.53A8.348 8.348.0 0022 5.92a8.19 8.19.0 01-2.357.646 4.118 4.118.0 008.224 8.224.0 1-2.605 004.107.0.0-6.993 3.743 110 1-8.457-4.287 4.106 001.27 5.477A4.072 4.072.0 012.8 9.713v.052.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233.0 012 18.407a11.616 11.616.0 006.29 1.84"/></a><a target=_blank href=https://github.com/asanobuturi><svg class="w-5 h-5" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483.0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951.0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65.0.0.84-.27 2.75 1.026A9.564 9.564.0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688.0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855.0 1.338-.012 2.419-.012 2.747.0.268.18.58.688.482A10.019 10.019.0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/></a></nav></div></footer></body></html>